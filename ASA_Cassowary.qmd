---
title: "Advanced statistical analysis (ASA)"
subtitle: "Cassowary Project"
author: "Capucine Benoit-Grignard, Lily Houles, Adèle Kieffer, Valentin Lucas, Ifssan Sairi"
date: "`r Sys.Date()`"
format:
  html:
    toc: true
    toc-floating: true
    number-sections: true
    code-fold: true
    bibliography: references.bib
    embed-resources: true
    toc-depth: 4
    theme: cosmo
    highlight-style: pygments
    fig.align: center
---

```{css}
#| echo: false
p {
  text-align: justify
}
```

# Introduction & context

![](images/cassowary.jpg){width="672"}

The southern cassowary (*Casuarius casuarius johnsonii)* is a territorial and solitary animal difficult to observe due to its endangered status and elusive behavior (@moore_population_2007). Individuals have a territory estimated between 0.52 km² to 2.35 km² and only come into contact during the mating season or in area where food resources are important (@moore_population_2007). This bird occur in the wet tropical rainforest of north-eastern Australia and in associated vegetation mosaics (@moore_population_2007). It's a frugivorous bird that may also use other habitats for dispersal or as intermittent food resources (@westcott_counting_1999, @campbell_southern_2023). Its ecological status is important as it's one of the few frugivorous capable of dispersing large rainforest fruit seeds over long distance (@westcott_counting_1999). In recent decades, populations have been affected by several factors such as natural catastrophic events, diseases, dog attacks, roads traffic and habitat implications, including degradation, fragmentation and loss (Queensland Parks and Wildlife Services, 2001).

It is essential to estimate the factors that may impact the abundance of southern cassowary population in order to ensure its conservation. @dwyer_using_2016 used citizen science data to model the risk of traffic strike in Australia. Sum of road collisions and abundance data were recorded by Queensland Parks and Wildlife Services between 1992 and 2012 (20 years) on 1 km² grid-cells covering the study area.\
Using this data, compiled with the habitat variables and the distance of road location of each grid-cells by @dwyer_using_2016, we aim to answer the following questions :\
**Which factors influence the southern cassowary abundance ? Is there any implication for strike mortality management ?**

![](images/fig1_study_area.png){width="669"}

**Fig. 1.** (a) Predicted distribution of southern cassowary *Casuarius casuarius johnsonii* in the Wet Tropics region of Queensland, Australia. Grey shaded area represents predicted cassowary habitat.\
(b) Map of the study area showing the locations of roads and landscape features. The number of sightings and traffic strikes that have occurred are geo-referenced in 1 km grid cells. (from @dwyer_using_2016)

::: {#tbl-descrva}
| Variable name | Ecological reference |
|------------------------------------|------------------------------------|
| `Rainforest.P` (quantitative continue) | proportion of rainforest within the grid |
| `Residential.P` (quantitative continue) | proportion of residential area within the grid |
| `Fruit.P` (quantitative continue) | proportion of fruit crop within the grid |
| `Other.P` (quantitative continue) | proportion of other area (pasture, wetland) within the grid |
| `Total_Road` (quantitative continue) | length of road within the grid |
| `Sightings` (quantitative counting) | visual contact of cassowary |
| `Strikes` (quantitative counting) | mortality of cassowary due to road traffic |
| `Residential.01` (quantitative binary) | presence /absence of residential area |
| `Fruit.01` (quantitative binary) | presence /absence of fruit crop |
| `Dresid` (quantitative continue) | distance of the road to residential area |
| `Dfruit` (quantitative continue) | distance of the road to fruit crop area |

Table of the cassowary variables and their ecological meaning.
:::

To answer the questions, we will first formulate a model with `Sightings` as a response variable to determine which factors influence the species abundance and then analyse the results. Then, we will study another model with `Strikes` as a response variable in order to identify the factors that influence the mortality of cassowary in the studied area and ways to limit it, thinking about a conservation approach.

We note that `Sightings` doesn't represent actual abundances of Cassowaries, but counts made over 20 years by several people who participated in a citizen science program. The number of `Sightings` does not reflect the number of cassowary individuals, but rather the number of observations in each grid-cell of 1 km². Therefore, to answer the main question, we study the influence of factors on a proxy for abundance, where `Sightings` give an idea of cassowary activity and in what context they were observed most often and were therefore most abundant.

In this study, we have several variables linked to the environment as well as the latitude and longitude of each cell. Close cells may have similar environmental conditions and that may influence the count of cassowaries. Cassowaries can probably move from a cell to another cell nearby, this can also influence `Sightings`. There are repeated counts in some cells : they were carried out over several years and each year, several citizens came to count in the same patches. Therefore, it is possible that there is spatial correlation between the different cells. The coordinates of the grid-cells centroids will enable us to test for spatial autocorrelation.

**Hypothesis:** *We assume that southern cassowary is mainly distributed near its natural habitat (rainforest) or in areas where food is available (fruit crop areas). We expect that high proportions of rainforest and fruit crops are associated with greater cassowary abundance.*\
*We also assume that strikes (cassowary mortality due to road traffic) is higher when the road connects to favorable habitats, with a short distance between fruit crops and road.*

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE, cash = TRUE)
```

**R Libraries**

```{r dowload libraries, message = FALSE, warning = FALSE}
# Models
library(nlme) #glm mixed and gls
library(DHARMa) #diagnosis for lm, glm
library(tidyverse) #for data cleaning, ordering
library(ggplot2)
library(MASS)
# Spatial analysis 
library(geoR) #for spatial object to perform geostatistic
library(sp)
library(sf) #deal with spatial data
library(pgirmess) #for spatial correlogram
library(spdep) #to extract the neighbors is a spatial data
library(ade4) #used to plot spatial data
library(spatialreg) #used for spatial data modelling
library(spgwr) #to run geographically weighted regression
library(dplyr)
library(mapview) #maps with openstreetMap
library(corrplot) #correlation plot
library(effects) #plot effects of variables
```

# Data

```{r data importation}
cassowary <- read.table("data_cassowary.txt", h = T)
summary(cassowary)
```

```{r data NA}
#Is NA?  
colSums(is.na(cassowary))
```

There are no NA values in the data set.

# Abundance of the cassowary

## Data exploration

### Variable distribution

#### Distribution of the response variable Sightings {.unnumbered}

```{r data response variable abundance}
#| label: fig-sighting_descr
#| fig-cap: "Distribution of the response variable : Cassowary sightings"

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("blue4", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Sightings,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary observation',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Sightings,
         pch = 16, col = col_transp,
         xlab = 'Cassowary observation',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Sightings,
  col = col_transp,
  border = "white",
  xlab = "Cassowary observation",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Sightings, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(cassowary$Sightings, col='red', lwd=2)
```

There are some outliers in the distribution of Y (@fig-sighting_descr).

```{r}
table(cassowary$Sightings) 
prop.table(table(cassowary$Sightings)) * 100
```

`Sightings` were obtained thanks to counting : we will first use a Generalized Linear Model with a Poisson distribution to study it.

65% of `Y` values are zeros : it represents a lot of zeros and it may have an influence on the model. The maximum value is really high : 572. The large dispersion of values and the amount of zeros can then influence the model and the way we will formulate it to study `Sightings`.

Cassowaries are rarely and higlty territorial, with approximativly 1 individual/km² (@moore_population_2007). In some cells, some values of `Sightings` are up to 100 counts / km², but it can be normal : as explained before, `Sightings` don't reflect actual abundance of cassowaries but the frequency of observation by citizens.

The data will be discussed because an overcounting by citizens can be possible. Sometimes individuals can be double-counted in the context of a citizen science program. We could then attempt to study `Y` as it is and then limit the counts in certain cells to limit overdispersion and compare different methods.

#### Distribution of environmental variables {.unnumbered}

We assume that the environmental variables that can influence cassowary abundance are the abundance of a certain type of habitat and the presence/absence of these habitats in cells where cassowaries are counted. We also test if there is a correlation with distances.

-   **Description of quantitative continue variables :**

```{r X abundance variables, fig.show = "hold"}
#| label: fig-distribenv
#| fig-cap: "Distribution of environmental variables"
#| fig-show: hold

env <- cassowary %>%
  dplyr::select(Rainforest.P, Residential.P, Fruit.P, Other.P, Total_Road, 
                Dresid, Dfruit)

par(mfrow = c(2, 2))
for(i in 1:ncol(env)){
  boxplot(env[,i], col = col_transp, border = "gray30", 
          ylab = colnames(env)[i], main = 'Boxplot')
  dotchart(env[,i], pch = 16, col = col_transp, border = "gray30", 
           xlab = colnames(env)[i], main = 'Cleveland plot') 
  hist(env[,i], col = col_transp, border = "gray30", xlab = colnames(env)[i], 
       main = "Histogramm")
  qqnorm(env[, i], pch = 16, col = col_transp, border = "gray30", 
         main = "QQ plot")
  qqline(env[, i], col = 'red', lwd = 2)
}
```

We can note presence of outliers in some covariates (`Residential.P` and `Total_Road`) with high dispersion. Next, we must be careful that this does not skew the model results. If this is the case, we could try a log transformation of these covariates.

-   **Description of quantitative binary variables : Fruit.01 and Residential.01**

```{r}
#Residential.01 : presence/absence of residential area
cassowary$Residential.01 <- as.factor(cassowary$Residential.01)
summary(cassowary$Residential.01)

#Fruit.01 : presence/absence of fruit crop
cassowary$Fruit.01 <- as.factor(cassowary$Fruit.01)
summary(cassowary$Fruit.01)
```

There is a good balance between presence and absence for each variable. However, studying the effect of presence/absence of fruit crop in cells and the effect of proportion of fruit crop in cell in the same model can be redundant. The same can be told for presence/absence of residential area and proportion of residential area within the grid.

### Potential relationships between response variable (Sightings) and explanatory variables

-   **Potential relationships between response variable (Sightings) and quantitative variables :**

```{r}
#| label: fig-relatio_Sight_quant
#| fig-cap: "Changes in Sightings values based on quantitative environmental variables "

par(mfrow=c(2, 2))

# Rainforest.P
plot(cassowary$Sightings ~ cassowary$Rainforest.P, pch = 16,
     col = 'olivedrab4', xlab = 'Proportion of rainforest', ylab = 'Sightings')

# Residential.P
plot(cassowary$Sightings ~ cassowary$Residential.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of residential area', ylab = 'Sightings')

# Fruit.P
plot(cassowary$Sightings ~ cassowary$Fruit.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of fruit crop', ylab = 'Sightings')

# Other.P
plot(cassowary$Sightings ~ cassowary$Other.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of wetlands and pasture', 
     ylab = 'Sightings')

# Total_Road
plot(cassowary$Sightings ~ cassowary$Total_Road, pch = 16, 
     col = 'olivedrab4', xlab = 'Road length inside of the grid', 
     ylab = 'Sightings')

# Dfruit
plot(cassowary$Sightings ~ cassowary$Dfruit, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance between road and fruit crops', 
     ylab = 'Sightings')

# Dresid
plot(cassowary$Sightings ~ cassowary$Dresid, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance between road and residential area', 
     ylab = 'Sightings')
```

-   **Potential relationships between response variable (Sightings) and qualitative variables :**

```{r}
#| label: fig-relatio_Sight_quali
#| fig-cap: "Changes in Sightings values based on qualitative environmental variables "

par(mfrow = c(2, 1))

# Residential.01 
boxplot(cassowary$Sightings ~ cassowary$Residential.01, pch = 16,
        col = 'olivedrab4', xlab = 'presence/absence of residential area',
        ylab = 'Sightings')

# Fruit.01
boxplot(cassowary$Sightings ~ cassowary$Fruit.01, pch = 16,
        col = 'olivedrab4', xlab = 'presence/absence of fruit crop',
        ylab = 'Sightings')
```

Using graphs (@fig-relatio_Sight_quali), it seems difficult to see relations between $Y$ and $Xs$. One explanation is that there are a lot of zeros in `Sightings`. Nevertheless, we observe that more cassowary individuals are observed when `Rainforest.P` is higher. The opposite relation is observed between Y and `Other.P`. `Other.P` and `Rainforest.P` could be correlated : we check correlation between $Xs$ in the following section. Regarding `Fruit.P`, it seems that cassowaries are more counted when the proportion of fruit crop is lower but when this proportion is higher, the counts are superior to 0 individuals. We also checked the relation between `Dresid` and `Sightings`, and the relation between `Dfruit` and `Sightings` : no obvious relations appear on graphs but ecologically, we think that `Sightings` is not influenced by `Dfruit` and `Dresid`. We won't test these two relations.

### Correlation between environmental variables $X$

-   **Collinearity between continuous environmental variables :**

```{r correlation abundance X}
#| label: fig-corrplot
#| fig-cap : "Correlation between environmental variables"

correlation <- cor(env)
corrplot(correlation, type = "upper", method = "number")
```

This @fig-corrplot shows a negative correlation (-0.82) between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`. This result was expected since the habitat proportion variables per cell are constructed together. For the analysis, we will keep `Rainforest.P` : if it influences cassowary abundance, it can be linked directly to the literature.

This @fig-corrplot shows a negative correlation between the proportions of different habitats per cell (notably -0.82 between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`). This result was expected since the habitat proportion variables per cell are constructed together. We also have strong correlations between variables made from the same information : i.e `Residential.01` (presence /absence of residential area),`Residential.P` (proportion of residential area in the grid), and `Dresid` (distance of the road to residential area), or `Fruit.P`, `Fruit.01` and `Dfruit`.

This @fig-corrplot shows a negative correlation between the proportions of different habitats per cell (notably -0.82 between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`). This result was expected since the habitat proportion variables per cell are constructed together.

-   **Collinearity between categorical and continuous environmental variables :**

```{r}
#| label: fig-colinea_fruit01
#| fig-cap : "Collinearity between categorical and continuous environmental variables"

par(mfrow=c(2,3))

# Rainforest.P and Fruit.01
boxplot(cassowary$Rainforest.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of rainforest",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Residential.P and Fruit.01
boxplot(cassowary$Residential.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of residential area",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Fruit.P and Fruit.01
boxplot(cassowary$Fruit.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of fruit crop",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Dfruit and Fruit.01
boxplot(cassowary$Dfruit ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Distance between road and fruit crop",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Dresid and Fruit.01
boxplot(cassowary$Dresid ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Distance between road and residential area",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Total_Road and Fruit.01
boxplot(cassowary$Total_Road ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Lenght of road within the grid",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")


par(mfrow = c(2,3))

# Rainforest.P and Residential.01
boxplot(cassowary$Rainforest.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion de Rainforest",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Residential.P and Residential.01
boxplot(cassowary$Residential.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion of residential area",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Fruit.P and Residential.01
boxplot(cassowary$Fruit.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion of fruit crop",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Dfruit and Residential.01
boxplot(cassowary$Dfruit ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Distance between road and fruit crop",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Dresid and Residential.01
boxplot(cassowary$Dresid ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Distance between road and residential area",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Total_Road and Residential.01
boxplot(cassowary$Total_Road ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Lenght of road within the grid",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

```

There is a positive correlation between the data on the presence/absence of fruit crops `Fruit.01` and the proportion of fruit crops within the grid `Fruit.P` (as well as for the presence/absence of residential areas `Residential.01` and the proportion of residential areas within the grid `Residential.P`). This result is also expected because these variables highlight similar information. It will therefore be necessary in the subsequent analysis to choose which environmental variables to select in order to avoid them being too correlated.

### Analysis of possible interactions between environmental variables $X$

```{r}
#| label: fig-int
#| fig-cap : "Interaction between environmental variables"

par(mfrow=c(2,2)) 

# Interactions between Rainforest.P & Fruit.01 ---------------------------------
plot(cassowary$Sightings ~ cassowary$Rainforest.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of rainforest")
points(cassowary$Sightings[cassowary$Fruit.01 == "0"] ~ cassowary$Rainforest.P[cassowary$Fruit.01 == "0"], 
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(cassowary$Sightings[cassowary$Fruit.01 == "1"] ~ cassowary$Rainforest.P[Fruit.01 == "1"], 
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions between Rainforest.P & Residential.01 ---------------------------
plot(Sightings ~ Rainforest.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of rainforest", data = cassowary)
points(Sightings[Residential.01 == "0"] ~ Rainforest.P[Residential.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Residential.01 == "1"] ~ Rainforest.P[Residential.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions between Residential.P & Fruit.01 --------------------------------
plot(Sightings ~ Residential.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of residential area", data = cassowary)
points(Sightings[Fruit.01 == "0"] ~ Residential.P[Fruit.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Fruit.01 == "1"] ~ Residential.P[Fruit.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions beteween Fruit.P & Residential.01 -------------------------------
plot(Sightings ~ Fruit.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of fruit crop", data = cassowary)
points(Sightings[Residential.01 == "0"] ~ Fruit.P[Residential.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Residential.01 == "1"] ~ Fruit.P[Residential.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 
```

We could test interactions in the model if necessary, but there do not appear to be any strong interactions between these variables. Furthermore, the variables `Residential.01` and `Fruit.01` include information already present in `Residential.P` and `Fruit.P`, so it does not seem necessary to include them in the models.

### Observations regarding spatial data with cartography

```{r spatial configuration}
#| label: fig-1rstcarto_cells
#| fig-cap: "First view of grid-cells distribution"

plot(cassowary[,2:3])
```

The points are distributed continuously, even if some locations are missing (@fig-1rstcarto_cells).

By projecting the locations onto an OpenStreetMap, to look closer :

```{r}
#| label: fig-carto_cells
#| fig-cap: "Map of presence / absence of Cassowary seen on the grid-cells"

cassow_sf <- cassowary %>% 
  mutate(abs = ifelse(Sightings == 0, "abs", "pres"), 
         morta = ifelse(Strikes == 0, "pas_morta", "morta")) %>%
  st_as_sf(., coords = c("longitude", "latitude"), crs = "EPSG:28355")  

cassow_sf %>% 
  mapview(zcol = "abs", layer.name = "Cassowary sightings", 
          map.types = c("OpenStreetMap.DE"))
```

The grid-cells are distributed evenly throughout the space, but follow the layout of the roads : therefore, there are no cells in the middle of the rainforests.\
The difference in the extent of rainforests between the OpenStreetMap base map (@fig-carto_cells) and that of the article is probably due to the time difference between the sources (and the possible deforestation).

```{r}
#| label: fig-carto_pabs
#| fig-cap: "Map of Cassowary abundance on the grid-cells"

mapview(cassow_sf %>% filter(abs == "abs"), 
        zcol = "abs", col.regions = "white", layer.name = "Absence", 
        map.types = c("OpenStreetMap.DE")) + 
  mapview(cassow_sf %>% filter(abs == "pres"), 
          zcol = "Sightings", layer.name = "Abondance", 
          map.types = c("OpenStreetMap.DE"))
```

This map shows that cassowary sightings tend to be more common in the rainforest part (@fig-carto_pabs).

```{r}
#| label: fig-carto_collision
#| fig-cap: "Map of the number of collisions recorded"

mapview(cassow_sf %>% filter(morta == "pas_morta"), 
        zcol = "Strikes", col.regions = "white", 
        layer.name = "No traffic strikes recorded", 
        map.types = c("OpenStreetMap.DE")) + 
  mapview(cassow_sf %>% filter(morta == "morta"), 
          zcol = "Strikes", layer.name = "Number of traffic strikes recorded", 
          map.types = c("OpenStreetMap.DE"))
```

The mortality strike occur on the road near the rainforest and where cassowaries appear to be abundant.

With these observations and the collinearity observed before, we can keep `Rainforest.P` instead of `Other.P`for the model. It can have more direct signification while formulating the model.

## Statistical Analysis

### Spatial dependency: semi-variogramm & correlogram

First, we have to investigate whether there is spatial dependency in the variables. As this can be seen as a continuous process, we will visualize the semi-variograms. For this first model, relating to the first problematic **"Which factors influence the southern cassowary abundance?"**, we will not consider `Strikes` and the variables directly linked to the road (`Total_Road`, `Dresid`&`Dfruit`).

```{r}
geo_sight <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                               data.frame(cassowary$Sightings)))
geo_rainp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                               data.frame(cassowary$Rainforest.P)))
geo_residp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Residential.P)))
geo_fruitp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Fruit.P)))
geo_otherp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Other.P)))
```

In order to plot the semi-variance plots (semi-variograms) for the variables, especially the response variable, we need to examine the distribution of distances between points.

```{r}
#| label: fig-distribdist
#| fig-cap: "Distribution of distances between sites"

hist(dist(cassowary[,2:3]), xlab = "Distance between sites (in meters)", 
     ylab = "Frequency", main = "")
```

We can see that 95% of the distance are under 25 000, 30 000 meters.

```{r semivar}
#| label: fig-semivario
#| fig-cap: "Empirical semi variogram for sightings of cassowary"

semivar_sight <- variog(geo_sight, option = "bin", max.dist = 30000, messages = FALSE)
semivar_rain <- variog(geo_rainp, option = "bin", max.dist = 30000, messages = FALSE)
semivar_residp <- variog(geo_residp, option = "bin", max.dist = 30000, messages = FALSE)
semivar_fruitp <- variog(geo_fruitp, option = "bin", max.dist = 30000, messages = FALSE)
semivar_otherp <- variog(geo_otherp, option = "bin", max.dist = 30000, messages = FALSE)

par(mfrow = c(1, 1))
plot(semivar_sight, main = "Sightings of cassowary")
```

```{r semivar}
#| label: fig-semivario2
#| fig-cap: "Empirical semi variogram for environmental variables"

par(mfrow = c(2, 2))
plot(semivar_rain, main = "Proportion of rainforest")
plot(semivar_residp, main = "Proportion of residential area")
plot(semivar_fruitp, main = "Proportion of fruit crop")
plot(semivar_otherp, main = "Proportion of other")
```

As we can see from all the plots of @fig-semivario, except maybe for the semi-variogram for the presence/absence of residential areas, **the values between points seem to become less similar as the distance increases, until it reaches 15 000 or 20 000 meters.** From this point, the variance seems to decrease, meaning that the points start to become more similar again. On the semi-variogram for the proportion of fruit crops, we can even see two maxima.

These types of graphs are usually indicative of a **periodic phenomenon**, also known as **patches or clusters**. However, in this case, we did not apply any transformation on the data. In fact, `Sighthings` are count data, `Residential.P` and `Fruit.P` contain many zeros, `Residential.01` and `Fruit.01` are presence/absence variables.

It is important to consider this because, behind the variogram, there are 2 fundamental assumptions valid for any location, also known as the second-order stationarity : stationarity of the expected value and stationarity of the covariance (covariance between two points depends only on the spatial shift of vector `h`, and not on the absolute positions). These assumptions presuppose a certain spatial homogeneity of the phenomenon under study, which is not the case for our variables of interest (for instance, in Poisson distribution, the variance increases linearly with the mean).

```{r}
#| label: fig-correlograms
#| fig-cap: "Correlograms for environmental variables"

par(mfrow = c(2,3))
plot(correlog(cassowary[,2:3], cassowary$Sightings, method = "Moran", nbclass = 12),
     main = "Sightings")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Rainforest.P, method = "Moran", nbclass = 12),
     main = "Rainforest proportion")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Residential.P, method = "Moran", nbclass = 12),
     main="Proportion of residential area")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Residential.P, method = "Moran", nbclass = 12),
     main="Proportion of fruit crop")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Total_Road, method = "Moran", nbclass = 12),
     main="Length of the road")
abline(h = 0, lty = 2)
```

These correlograms are based on Moran's index (@fig-correlograms). High values are positively correlated with each other. The red dots represent significant correlations. Most variables show autocorrelation up to 7 km (7000m).

### GLM with Poisson Distribution

As we have count response data (i.e quantity of events), we used **generalized linear models** (GLMs) with a **Poisson** distribution and a log-link function (@mohammed2025spatial).\
$Sightings$ \~ $P(\lambda)$, with $\lambda$, the expectation and variance rate of events. With a Poisson distribution, variance increases linearly with the mean.\
With the log-link function : $log(\lambda_i) = \alpha + \beta_iX_i + \varepsilon_{i}$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independent variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables \
Here, we model :\
$log(\lambda_i) = \alpha + \beta_1Raiforest_i + \beta_2Residential.P_i + \beta_3Fruit.P_i + \beta_4TotalRoad +\varepsilon_{i}$

Some information is redundant and some variables are correlated (@fig-corrplot) : we remove the variables `Residential.01` and `Fruit.01` (redundant with `Residential.P` and `Fruit.P`) and `Other.P` (correlated to `Rainforest.P`). We keep `Total_Road`, we think it may also influence the response variable.

```{r}
glm_pois1 <- glm(Sightings ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, 
                 data = cassowary, 
                 family = poisson(link="log"))
summary(glm_pois1)
```

-   **Overdispersion check (scale parameter calculation) :**\
    *Overdispersion means that that residual variance is larger than expected under the fitted model. If overdispersion is present, confidence intervals will tend to be too narrow, and p-values too small, leading to inflated type I error. This phenom is most common for GLM families with constant dispersion, such as Poisson models. (@dharma_hartig)*

```{r}
#| label: fig-dharma1
#| fig-cap: "DHARMa check for dispersion, outliers in the model residuals"

simout <- simulateResiduals(fittedModel = glm_pois1, plot = F)
plot(simout)
```

Here, there is overdispersion, it can be due to outliers, model misfit, missing interactions or zero-inflation.

We can take a closer look at the issues on the model (zero-inflation and overdispersion) :

```{r}
#|label: fig-dharma1
#|fig-cap: "Zero-inflation and dispersion check on the residuals with DHARMa package"

testDispersion(simout)
testZeroInflation(simout)
```

Dharma test shows also zero-inflation (i.e a situation in which more zeros appear in the observations than are expected under the fitted model).

Other methods can be used to study the overdispersion of residuals : - Ratio residual deviance / ddl $\phi$ :\
It allows us to estimate whether the actual variance of the observations is not too far from the theoretical variance : $\phi = \frac{\text{variance observed}}{\text{theoretical variance}} = \frac{residual deviance}{number of degrees of freedom}$\
If this ratio is greater than 1, then there is overdispersion. It is based on log-likelihood and is less sensitive to extreme points.

```{r}
#based on the results of glm_pois1
8257.2/249
```

Here, there is overdispersion.

-   Pearson residuals :

```{r}
E1 <- resid(glm_pois1, type = "pearson") # (Y - mu) / sqrt(mu)
N  <- nrow(cassowary)
p  <- length(coef(glm_pois1))
sum(E1^2) / (N - p)
```

Here, the Pearson residuals are way above 1, so there is overdispersion.

### GLM with Negative Binomial Distribution

To account for the overdispersion of the residuals, we switch to a GLM with a **Negative binomial** distribution, with a log-link function.\
$Sightings$ \~ $NB(\mu, \phi)$, with $\mu$ the mean of the distribution, and $\phi$ the dispersion parameters.\
With the log link function : $log(\mu_i) = \alpha + \beta_iX_i + \varepsilon_{i} = \eta$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independant variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables \
Here, we model  $log(\mu_i) = \alpha + \beta_1Raiforest_i + \beta_2Residential.P_i + \beta_3Fruit.P_i + \beta_4TotalRoad +\varepsilon_{i}$

```{r}
glm_NB <- glm.nb(Sightings ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, data = cassowary)
summary(glm_NB)
coef <- glm_NB$coefficients
```

We use the step AIC to try to make a selection.

```{r}
model1 <- stepAIC(glm_NB, direction = "backward") 
```

The difference between AIC is less than 2. We keep the model with all the variables, even though `Total_Road` is not significant. 

-   **Overdispersion check (scale parameter calculation) :**\
-   Dharma test :

```{r}
#| label: fig-dharmaNB
#| fig-cap: "DHARMa check for dispersion, outliers in the model residuals"

simout_NB <- simulateResiduals(fittedModel = glm_NB, plot = F)
plot(simout_NB)
testZeroInflation(simout_NB)
testDispersion(simout_NB)
```

There is no longer any overdispersion : the negative binomial distribution seems appropriate in this case. If this had not been the case, we would have considered other distributions, such as the one that include zero-inflation (i.e. a situation in which more zeros appear in the observations than are expected under the fitted model).

-   Ratio residual deviance / ddl :

```{r}
173.48/249
```

Here, the ratio \< 1 : there is no overdispersion.

-   Residus de Pearson :

```{r}
E1 <- resid(glm_NB, type = "pearson") # (Y - mu) / sqrt(mu)
N  <- nrow(cassowary)
p  <- length(coef(glm_NB))
sum(E1^2) / (N - p)
```

```{r}
#| label: fig-semivariog_NB
#| fig-cap: "Semi-variogram of the residuals of the negative binomial model "

geo_resid <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]), 
                                               data.frame(E1)))
semivar_resid <- variog(geo_resid, option = "bin", max.dist = 30000)
plot(semivar_resid, main = "")
```

We still have an abnormal semi variogram, showing spatial dependence with a non-stationary case.

-   **Spatial autocorrelation check :**\
    Since we have spatial data, we need to check for any spatial dependence between observations, by looking for spatial autocorrelation in the model residuals, with the DHARMa Moran's I test (@dharma_hartig).

```{r}
#|label: fig-dharmaspat_NB
#|fig-cap: "Spatial autocorrelation check on NB model residuals with DHARMa package"

# Dharma procedure :
testSpatialAutocorrelation(simulateResiduals(glm_NB), 
                           x = cassowary$longitude, y = cassowary$latitude)
```

For each point, we have a local Moran index.\
Here, the observed Moran's index is higher than the expected. This indicates a tendency towards clustering. There is significant positive autocorrelation (p-value \< 2.2e-16) : this means that two observations close together are more likely to be similar than two observations far apart. On the contrary, when there is no spatial dependance, in a stationary process, the residuals are spatially random.\
Here, the intensities and the colours of the points vary a lot, indicating global non-stationarity of the relationship between `Sightings` and the explanatory variables.

-   **First visualisation of result :**\
    Even if our model is not correct because of spatial autocorrelation, we can still write the equation and visualize the predictors of the Negative Binomial GLM.

$Sightings$ \~ $NB(\mu, \phi)$\
$$
\log(\mu_i) =
`r round(coef[1], 3)` +
`r round(coef[2], 3)` \times \text{Rainforest.P} +
`r round(coef[3], 3)` \times \text{Residential.P} +
`r round(coef[4], 3)` \times \text{Fruit.P} +
`r round(coef[5], 3)` \times \text{Total\_Road}
+ \varepsilon_i
$$

```{r}
#|label: plot_alleffects
#|fig-cap: "Predictor effects on Sightings"

plot(allEffects(glm_NB), ci.style = "bands", type = "response")
```

**For visibility reasons, the scale of the Y-axis is adapted to each variable, so the effects visible on the plot are not visually comparable.** It shows the effects plotted on the scale of the linear predictor, but the vertical axis is labelled on the response scale. This preserves the linear structure of the model while permitting interpretation on what is usually a more familiar scale (@R_effects)\
The model shows very high confidence intervals for `Residential.P` (with an upper bound of 2 500 sightings predicted, whereas the maximum number per cell was 572). This can be explained by the low number of high `Residential.P` data points (see small bars on the X-axis). The same applies to Fruit.P, even though the upper limit of the confidence interval only rises to 80 sightings.

### Geostatistical model GWR

The previous models had strong spatial autocorrelation. The **GWR model** allows us to take **local** spatial dependence into account. For each observation, a regression is fitted based only on the localized neighborhood, so we obtain one intercept and one estimate for each point.

We define the *SpatialPointsDataFrame* with both variables and coordinates, and optimize the bandwidth for the kernel function. We tried to use a GGWR rather than a GWR because, as we saw, the Negative binomial model seems to be the most appropriate one. However, the ***bw.ggwr*** and ***gwr.generalised*** functions did not work as expected (there were a lot of problems that we didn't know how to solve). We tried using a log(Y+1) transformation on the response variable in a general linear model, and then the ***gwr*** function. The goal is to make the distribution of the response variable closer to a Gaussian, allowing classical GWR (gwr) to be used on a linear model.

#### A study of log(Sightings + 1) as the response variable

-   **Distribution of Y_1 = log(Sightings + 1)**

```{r Y1}
#|label: fig-logsight
#|fig-cap: "Distribution of log(Sightings +1)"

cassowary$Y_1 = log(cassowary$Sightings + 1)

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("blue4", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Y_1,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary observation',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Y_1,
         pch = 16, col = col_transp,
         xlab = 'Cassowary observation',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Y_1,
  col = col_transp,
  border = "white",
  xlab = "Cassowary observation",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Y_1, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(cassowary$Y_1, col='red', lwd=2)
```

There are still many zeros and a non-gaussian distribution of the variable to be explained, despite the log transformation.

-   **Linear model with log(Sightings + 1) :**\

```{r model lm}
try_linear <- lm(Y_1 ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, data = cassowary)
summary(try_linear)
```

-   **Residuals normality and homoscedasticity :**\

```{r}
#| label: fig-lm_check
#| fig-cap: "Verification of the validity conditions of the lm model on residuals"

par(mfrow = c(2, 2))
plot(try_linear, pch = 19, col = "blue")
```

The first plot shows a rejection of the assumption of homoscedasticity of the residuals. The second graph (normalQ-Q plot) shows non-normality of the residuals, which should follow the first bisector. The fourth plot shows the presence of outliers, whose value, even when logged, strongly influences the model. Overall, we can see that the linear model is not suitable, even with a log +1 transformation of `Sightings`.

-   **Spatial autocorrelation test :**\

```{r}
#| label: fig-Dharma_spat_lm
#| fig-cap: "Spatial dependance check on linear model with log(Sightings + 1) (DHARMa)"

testSpatialAutocorrelation(simulateResiduals(try_linear), 
                           x = cassowary$longitude, y = cassowary$latitude)
```

Presence of spatial autocorrelation for this model. 
Even if the assumptions for the linear model are not satisfied, we decide to try to implement a gwr model, to explore how relationships between variables vary across space.

#### GWR Model

To apply the **GWR model**, we have to define the SpatialPointsDataFrame with both the variables and the coordinates in an object called `geocass.`\
At this stage, we also optimize the bandwidth (a metric representing the distance between points or the number of neighbors used in each regression) for the kernel function (neighborhood weighting function), then we run the GWR model. The bandwith is determined using the spatial autocorrelogram, and most notably, the influence of the neighbors is weighted by a decreasing function of distance.

```{r}
geocass <- SpatialPointsDataFrame(data.frame(cassowary[,2:3]), 
                                  data.frame(cassowary[,c("Rainforest.P","Residential.P","Fruit.P", "Total_Road", "Sightings")]))

gwr.bw <- gwr.sel(log(Sightings+1) ~ Rainforest.P + Residential.P + Fruit.P + Total_Road,
                  data = geocass, adapt = FALSE)
lmgwrD <- gwr(log(Sightings+1) ~ Rainforest.P + Residential.P + Fruit.P + Total_Road,
              data = geocass, bandwidth = gwr.bw, se.fit = T, hatmatrix = T)
summary(lmgwrD)
```

The main interesting output is the SDF : the variables (intercept) and `Rainforest.P`, `Residential.P`, `Fruit.P` and `Total_Road` give the regression coefficients.\
`Intercept.se` and `Rainforest.P_se`, `Residential.P_se`, `Fruit.P_se` and `Total_Road_se` give the coefficient standard errors.

```{r}
names(lmgwrD$SDF)
```

Since it is a spatial object, we can map the coefficients and their significativity. Significativity of coefficient is not automatically computed by R, but, we can use the coefficients and their standard errors to calculate a t-statistic. Under the null hypothesis, the t-ratio follows a t-distribution, and we can therefore calculate the probability. To do this, we first get the degrees of freedom from the gwr results object. For instance, we can test the significativity of the parameters.

#### Getting the statistics for the GWR model

```{r}
dfree <- lmgwrD$results$edf

vars <- c("Rainforest.P", "Residential.P", "Fruit.P", "Total_Road")

gwr_signif_all <- lapply(vars, function(v) {
  
  # Coefficient and standard error for the variable v
  beta <- lmgwrD$SDF[[v]]
  se <- lmgwrD$SDF[[paste0(v, "_se")]]
  
  # Statistics
  t_val <- beta / se
  p_val <- 2 * (1 - pt(abs(t_val), df = dfree))
  
  # Classes
  classe_beta <- ifelse(beta < 0, "negative",
                        ifelse(beta > 0, "positive", "zero"))
  
  classe_p <- ifelse(p_val < 0.05, "p < 0.05", "p > 0.05")
  
  # Local Data frame 
  data.frame(variable = v, x = coordinates(geocass)[,1], y = coordinates(geocass)[,2],
    beta = beta, se = se, t = t_val, p = p_val,
    classe_beta = classe_beta, classe_p = classe_p)
}) %>% bind_rows()
```

#### Visualization of the GWR local coefficients for each variable

```{r}
#| label: fig-GWR_Rainforest
#| fig-cap: "GWR local coefficients for Rainforest.P"

 ggplot(gwr_signif_all %>% filter(variable == "Rainforest.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p < 0.05" = "red", "p > 0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw()
```

```{r}
#| label: fig-GWR_Resid
#| fig-cap: "GWR local coefficients for Residential.P"

ggplot(gwr_signif_all %>% filter(variable == "Residential.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p < 0.05" = "red", "p > 0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw()
```

```{r}
#| label: fig-GWR_fruit
#| fig-cap: "GWR local coefficients for Fruit.P"
#
ggplot(gwr_signif_all %>% filter(variable == "Fruit.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p < 0.05" = "red", "p > 0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw()
```

```{r}
#| label: fig-GWR_road
#| fig-cap: "GWR local coefficients for Total_Road"

ggplot(gwr_signif_all %>% filter(variable == "Total_Road"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p < 0.05" = "red", "p > 0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw()
```

#### Visualization of all the GWR local coefficients at the same time

```{r}
#| label: fig-GWR_all
#| fig-cap: "Local Maps of GWR coefficients (Sightings log transformed)"
 
ggplot(gwr_signif_all,
       aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  facet_wrap(~ variable, scales = "free") +
  scale_color_manual(values = c("p < 0.05" = "red", "p > 0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17)) +
  theme_bw()
```

## Results

The relationship between `Sightings` and `Fruit.P`, `Residential.P` and `Total_Road` is mostly significant in the north-east, whereas the significant effect of `Rainforest.P` is more widespread spatially. Where the effects of the variables are significant, they are mainly positive. Although the interpretation on the log scale is not very intuitive, we can conclude that, locally, the greater the proportion of fruit crops, residential areas and rainforest, and the larger the total road area within the grid, the greater the cassowary abundance.\

The variables that seem to have the greatest impact (greatest coefficients) on the cassowary abundance are `Rainforest.P.`, `Residential.P` and then `Fruit.P`. These results are consistent with what we observe with the native binomial model for `Rainforest.P.`and `Residential.P`. Cassowary abundance is mainly influenced by the proportion of rainforest, because cassowaries mostly need forests as a natural habitats.

The results we obtained regarding the effects of the proportion of residential areas and the total length of roads differ from our initial assumptions. This discrepancy could be attributed to the observation bias often encountered in participatory science studies. In fact, areas with a higher human population density (residential areas) are also those where people are more likely to report the presence of cassowaries, because people tend to explore the forest less, where cassowary abundance is directly linked to the species' ecology.

# Mortality of cassowary



## Data exploration

### Distribution of variables

#### Distribution of the response variable Strikes {.unnumbered}

```{r data response variable mortality}
#| label: fig-strikes_descr
#| fig-cap: "Distribution of the response variable : Cassowary strikes"

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("aquamarine4", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Strikes,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary mortality',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Strikes,
         pch = 16, col = col_transp,
         xlab = 'Cassowary mortality',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Strikes,
  col = col_transp,
  border = "white",
  xlab = "Cassowary mortality",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Strikes, pch=16, col=col_transp, xlab='', ylab='',
       main="QQ plot") 
qqline(cassowary$Strikes, col='red', lwd=2)
```

```{r}
table(cassowary$Strikes) 
prop.table(table(cassowary$Strikes)) * 100
```

There are some outliers in the `Strikes` distribution (@fig-strikes_descr). While most of values stop at 5 strikes per grid cell, there is one with 13 strikes listed. As we have no information on the temporal observations, we will include all values in the model. However, the data will be discussed because, in the context of a citizen science program, it is possible for citizens to overcount. Here, strikes can sometimes be double-counted.

As for the `Sightings` variable, `Strikes` correspond to count data, and we will use a **Generalized Linear Model with a Poisson distribution**.

84% of `Y` values are zeros, with a potential influence on the model.

#### Distribution of environmental variables {.unnumbered}

We assume that all road-related variables influence cassowary strike mortality. As cassowaries have a territory of about 1km², we assume that the probability of encountering a road is high if they live close to one. We also include abundance (with `Sightings`) in the model, as strike mortality may also depend on it. We can do a log-transformation on the `Sightings` variable, because there are outliers in its distribution.

```{r}
cassowary$LogSightings <- log(cassowary$Sightings +1)
```

```{r X road variables, fig.show = "hold"}
#| label: fig-distribmort
#| fig-cap: "Distribution of strikes explanatory variables"

road <- cassowary %>%
  dplyr::select(Total_Road, Dresid, Dfruit, Sightings, LogSightings, Rainforest.P)

par(mfrow = c(2, 2))
for(i in 1:ncol(road)){
  boxplot(road[,i], col = col_transp, border = "gray30", 
          ylab = colnames(road)[i], main = 'Boxplot')
  dotchart(road[,i], pch = 16, col = col_transp, border = "gray30", 
           xlab = colnames(road)[i], main = 'Cleveland plot') 
  hist(road[,i], col = col_transp, border = "gray30", 
       xlab = colnames(road)[i], main = "Histogramm")
  qqnorm(road[, i], pch = 16, col = col_transp, border = "gray30", 
         main = "QQ plot")
  qqline(road[, i], col = 'red', lwd = 2)
}
```

We will keep the log+1 transformation of the variable `Sigthings`, as there are a lot of outliers in the variable without the transformation.

### Potential relationships between response variable (Strikes) and explanatory variables

```{r}
#| label: fig-relatio
#| fig-cap: "Potential relationships between response variable (Strikes) and explanatory variables"

par(mfrow=c(3, 2))

# Total_Road
plot(cassowary$Strikes ~ cassowary$Total_Road, pch = 16,
     col = 'olivedrab4', xlab = 'Length of road within the grid', ylab = 'Strikes')

# Dresid
plot(cassowary$Strikes ~ cassowary$Dresid, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance of the road to residential area', ylab = 'Strikes')

# Dfruit
plot(cassowary$Strikes ~ cassowary$Dfruit, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance of the road to fruit crop', ylab = 'Strikes')

# Sightings
plot(cassowary$Strikes ~ cassowary$Sightings, pch = 16, 
     col = 'olivedrab4', xlab = 'Sightings', 
     ylab = 'Strikes')

# LogSightings
plot(cassowary$Strikes ~ cassowary$LogSightings, pch = 16, 
     col = 'olivedrab4', xlab = 'Log Sightings', 
     ylab = 'Strikes')

# Rainforest.P
plot(cassowary$Strikes ~ cassowary$Rainforest.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Rain forest proportion', 
     ylab = 'Strikes')
```

It seems to be a relationship between the `LogSightings` and `Strikes`, as well as `Rainforest.P`. We can also see a potential relationship between `Strikes` and `Total_Road` when the latter appears to be above 1km.

### Correlation between environmental variables $X$

-   **Collinearity between continuous environmental variables :**

```{r correlation mortality X}
#| label: fig-corrplot_strikes
#| fig-cap : "Correlation between explain variables for strikes"

corelation <- cor(road)
corrplot(corelation, type = "upper", method = "number")
```

Although there is a correlation between `Sightings` and `LogSightings`, we will simply keep the log+1 transformation in the model. There is also a correlation between `Rainforest.P` and `LogSightings`, but we can keep these variables in the model.

## Statistical Analysis

### Spatial dependency

```{r}
#| label: fig-correlograms2
#| fig-cap: "Correlograms for road link variables and sightings"

par(mfrow = c(2, 3))
plot(correlog(cassowary[, 2:3], cassowary$Strikes, method = "Moran", nbclass = 12),
     main = "Strikes")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Total_Road, method = "Moran", nbclass = 12),
     main = "Total road")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Dresid, method = "Moran", nbclass = 12),
     main = "Distance to the residential area")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Dfruit, method = "Moran", nbclass = 12),
     main = "Distance to the fruit crops")
abline(h = 0, lty = 2)
plot(correlog(cassowary[,2:3], cassowary$LogSightings, method = "Moran", nbclass = 12),
     main = "Log of the abundance")
abline(h = 0, lty = 2)
abline(h = 0, lty = 2)
plot(correlog(cassowary[,2:3], cassowary$Rainforest.P, method = "Moran", nbclass = 12),
     main = "Rainforest proportion")
abline(h = 0, lty = 2)
```

As for the first problematic, we analysed spatial dependency with correlograms based on Moran's index (@fig-correlograms2). High values mean that sites are correlated with each other, with red dots indicating significant correlation. For each variable, the values seem to be correlated up to around 10 km, which probably corresponds to the cassowary's distribution area in relation to the limits of the rainforest. As suggested by the results of the previous model, this spatial scale may also be related to reports of strikes and sightings in a particular area, where people are more likely to contribute data for citizen science.

### GLM with Poisson Distribution

As we have count response data (i.e quantity of events), we used **generalized linear models** (GLMs) with a **Poisson** distribution and a log link function (@mohammed2025spatial).\
$Strikings$ \~ $P(\lambda)$, with $\lambda$, the expectation and variance rate of events. Here, variance increases linearly with the mean.\
With the log link function : $log(\lambda_i) = \alpha + \beta_iX_i + \varepsilon_{i}$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independent variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables\
Here, we model\
$log(\lambda_i) = \alpha + \beta_1TotalRoad_i + \beta_2Dresid_i + \beta_3Dfruit_i + \beta4log(Sightings+1) + \beta_5Rainforest.P + \varepsilon_{i}$\
Since some explanatory variables had different scales, we scaled them (*scale* function). However, in order to be able to compare the effects of the variables with each other, we only centred them (*scale = F*) without reducing them.

```{r}
glm_pois_strikes <- glm(Strikes ~ scale(Total_Road, scale = FALSE) + 
                          scale(Dresid, scale = FALSE) + scale(Dfruit, scale = FALSE) + LogSightings + Rainforest.P,
                data = cassowary, 
                family = poisson(link ="log"))
summary(glm_pois_strikes)
```

-   **Dispersion and Zero-inflation check :**\

```{r}
#|label: fig-dharma_pois
#|fig-cap: "DHARMa check for dispersion, outliers and zero-inflation in the model residuals"

simrespois <- simulateResiduals(glm_pois_strikes)
testDispersion(simrespois)
testZeroInflation(simrespois)
plot(simulateResiduals(glm_pois_strikes))
```

With the Poisson distribution, residuals are over dispersed (fig-dharma_pois). So we switch to a Negative Binomial distribution. To test the zero-inflation and the dispersion, we also apply the function implemented in DHARMa package (@dharma_hartig). The check for dispersion shows a significant overdispersion.

### GLM with Negative Binomial distribution

To account for the overdispersion of the residuals, we switch to a GLM with a **Negative binomial** distribution, with a log link function. $Strikings$ \~ $NB(\mu, \phi)$, with $\mu$ the mean of the distribution, and $\phi$ the dispersion parameters.\
With the log link function : $log(\mu_i) = \alpha + \beta_iX_i + \varepsilon_{i} = \eta$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independant variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables\
Here, we model\
$log(\mu_i) = \alpha + \beta_1TotalRoad_i + \beta_2Dresid_i + \beta_3Dfruit_i + \beta_4log(Sightings_i+1)+ \beta_5Rainforest.P + \varepsilon_{i}$

```{r}
glm_nb_strikes <- glm.nb(Strikes ~ scale(Total_Road, scale= FALSE) + 
                           scale(Dresid, scale = FALSE) + scale(Dfruit, scale = FALSE) + LogSightings + Rainforest.P, 
                         data = cassowary)
summary(glm_nb_strikes)
```

```{r}
glm <- stepAIC(glm_nb_strikes, direction = "backward") 
```

With the step AIC, we select the best model. We keep the model with four variables `LogSightings`, `Dfruit`, `Total_Road` and `Rainforest.P`, even though the distance from road to fruit crops is not significant. The difference between AIC is less than 2, and given the issues with the `Y` variable, we prefer to keep the more complex model to explain strike mortality.

```{r}
glm_nb_strikes <- glm.nb(Strikes ~ scale(Total_Road, scale = FALSE) + 
                           scale(Dfruit, scale = FALSE) + LogSightings + Rainforest.P,
                         data = cassowary)
summary(glm_nb_strikes)
coef <- glm_nb_strikes$coefficients
```

-   **Dispersion check :**

```{r}
#| label: fig-dharma_NB2
#| fig-cap: "DHARMa check for dispersion, outliers and zero-inflation in the model residuals"
simresnb <- simulateResiduals(glm_nb_strikes)
testDispersion(simresnb)
plot(simulateResiduals(glm_nb_strikes))
testZeroInflation(simresnb)
```

With the negative binomial distribution, there is no more overdispersion of the residuals (@dharma_hartig). The model respect the assumption on the residuals.

-   **Spatial autocorrelation check :**\
    Since we have spatial data, we need to check whether there is any spatial dependence between observations by looking for spatial autocorrelation in the model residuals, with Moran test using Dharma package (@dharma_hartig).

```{r}
#| label: fig-Dharma_spat_mortNB
#| fig-cap: "Spatial dependance check on linear model with log(Sightings + 1) (DHARMa)"

testSpatialAutocorrelation(simulateResiduals(glm_nb_strikes), 
                           x = cassowary$longitude, y = cassowary$latitude)
```

There is no spatial autocorrelation in this model.

Since our model seems correct, we can write the model equation and visualized the predictors :\
$Strikings$ \~ $NB(\mu, \phi)$\
$$
\log(\mu_i) =
`r round(coef[1], 3)` +
`r round(coef[2], 3)` \times \text{Total\_Road} +
`r round(coef[3], 4)` \times \text{Dfruit} +
`r round(coef[4], 3)` \times \log(\text{Sightings}+1) +
`r round(coef[5], 3)` \times \text{Rainforest.P}
+ \varepsilon_i
$$

```{r}
#| label: fig-plot_alleffects_strikes
#| fig-cap: "Predictor effects on Strikes"

plot(allEffects(glm_nb_strikes), ci.style = "bands", type = "response")
```

**For visibility reasons, the scale of the Y-axis is adapted to each variable, so the effects visible on the plot are not visually comparable.**\
The results show that strikes increase exponentially with the abundance `Sightings`(@fig-plot_alleffects_strikes). However, it should be noted that the confidence interval around the number of strikes increases sharply as the number of sightings increases, since there are few high sighting values, as shown by the bars on the X-axis.\
It also shows a positive linearly relation with the rainforest proportion `Rainforest.P`.\
Strikes also seem to increase linearly when the distance of the road of fruit crop increase. The opposite result is observed with the total length of the road.

## Results of Mortality model

As for the first hypothesis, the first model tested was a **GLM with a Poisson distribution**. As there was overdispersion in the residuals, we changed to a **Negative Binomial model** to solve this issue. With this model, all assumptions about the residuals were validated. We opted for a NB model instead of a quasi-Poisson model, because the residuals assumptions checking of this semi-parametric distribution are not implemented in the DHARMa package (@dharma_hartig). After selecting the best NB model, we checked for spatial dependency with a Moran test, which was non-significant at the 5% alpha threshold.

As expected, the **strike mortality** is linked to the **presence of cassowaries** and **rainforest proportion** in the grid cell. The greater the number of individuals, the greater the risk of a collision with a car. Moreover, the greater the proportion of rainforest, the higher the risk of strike. While the effect of the distance between the road and fruit crops is not significant, it is important to take it into consideration, as it is the only parameter in the model with a negative estimate. This suggests that the further away fruit crops are from the road, the lower the strike mortality rate.

@webber_predicting_2025 have shown that road collisions with cassowaries are linked to the abundance and to a high proportion of their natural habitat. They also explain that some roads are riskier that others, since most collisions occur in a few 5 km x 5 km grid cells.     
In our model, the total length of the road is not significant in the final model, but it is logical that the more roads there are in a grid cell, the higher the probability of encountering a cassowary on the road and having a collision.

# Discussion 

For both `Sightings` and `Strikes` variables, observations were collected by citizens and summed over the entire period of the program. One alive individual can be counted several times, as well as a dead one. As cassowaries have a territory of around 1km², it is possible that all cassowaries seen in the same grid cell were actually one individual. As we do not have information on individual identity and sampling strategies, we cannot conclude on the true abundance of cassowaries, and can only speculate about their habitat.\
Moreover, most of the data was collected at the side of the road and not deeper in the rainforest, making the abundance difficult to determine. Indeed, it it possible that most individuals were seen close to a frequently used road, and so were more likely to be seen even over a 20-years period of data collection. This also causes a problem of the spatial pattern. We consider here the spatial structure as a continue one because grid cells are at regular interval, but there are some missing values and we don't have any information about this particularity.

The lack of information on temporal observations also caused issues in the analysis. If a strike was report, we cannot say if on this grid cell an observation of a new cassowary was report or not after the death. For cells where high abundances and high strike mortality were reported, we cannot say if a new individual was reported after the strike on the grid cell. If so, it is probably a new individual that has colonized the vacant territories. However, if this was not the case, we would be reporting the same individual several times, which would cause problems with the model and the hypothesis of cassowary favorable habitats and strikes. Furthermore, the initial study (@dwyer_using_2016) provides dated records of each cassowary sighting and strike, enabling temporal analyses that account for sampling bias.

# Conclusion

In conclusion, our results should be treated with caution as they are based on citizen science data. Indeed, our models are probably not quite adapted to this type of data, which demands great caution when analyzing it. The model for spatial autocorrelation in cassowary abundance estimation is not appropriate for Negative binomial distribution, and applying a log transformation to the Y count variable is not recommended (@ohara_log), particularly in the presence of 0, that can be distorted.\
So, one suggestion could be to better account for both spatial dependence and non-Gaussian distribution in the model with Sightings. This can be achieved by adding covariance structures (spherical or Gaussian, since we have patch structure), including the spatial coordinates of the points (@cov_struct), which can be done using the *glmmTMB* package (@glmmtmb).

To reduce cassowary strike mortality and preserve its natural habitat, limiting new road construction, reducing deforestation and implementing wildlife crossing remain the most effective strategies. Wildlife crossings could reduce fragmentation and road collision at the same time, making them one of the best solution currently. Ultimately, preventing further nature destruction remains the best long-term solution.