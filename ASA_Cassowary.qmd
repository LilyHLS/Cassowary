---
title: "Advanced statistical analysis (ASA)"
subtitle: "Cassowary Project"
author: "Capucine Benoit-Grignard, Lily Houles, Adèle Kieffer, Valentin Lucas, Ifssan Sairi"
date: "`r Sys.Date()`"
format:
  html:
    toc: true
    toc-floating: true
    number-sections: true
    code-fold: true
    bibliography: references.bib
    embed-resources: true
    toc-depth: 4
    theme: cosmo
    highlight-style: pygments
    fig.align: center
---

```{css}
#| echo: false
p {
  text-align: justify
}
```

# Introduction & context

![](images/cassowary.jpg){width="672"}

The southern cassowary (*Casuarius casuarius johnsonii)* is a territorial and solitary animal difficult to observe due to its endangered status and elusive behavior (@moore_population_2007). Individuals have a territory estimated between 0.52 km² to 2.35 km² and only come into contact during the mating season or in area where food resources are important (@moore_population_2007). This bird occur in the wet tropical rainforest of north-eastern Australia and in associated vegetation mosaics (@moore_population_2007). It's a frugivorous bird that may also use other habitats for dispersal or as intermittent food resources (@westcott_counting_1999, @campbell_southern_2023). Its ecological status is important as it's one of the few frugivorous capable of dispersing large rainforest fruit seeds over long distance (@westcott_counting_1999). In recent decades, populations have been affected by several factors such as natural catastrophic events, diseases, dog attacks, roads traffic and habitat implications, including degradation, fragmentation and loss (Queensland Parks and Wildlife Services, 2001).

It is essential to estimate the factors that may impact the abundance of southern cassowary population in order to ensure its conservation. @dwyer_using_2016 used citizen science data to model the risk of traffic strike in Australia. Sum of road collisions and abundance data were recorded by Queensland Parks and Wildlife Services between 1992 and 2012 (20 years) on 1 km² grid-cells covering the study area.\
Using this data, compiled with the habitat variables and the distance of road location of each grid-cells (@tbl-descrva) by @dwyer_using_2016, we aim to answer the following questions :\
**Which factors influence the southern cassowary abundance ? Is there any implication for strike mortality management ?**

![](images/fig1_study_area.png){width="669"}

**Fig. 1.** (a) Predicted distribution of southern cassowary *Casuarius casuarius johnsonii* in the Wet Tropics region of Queensland, Australia. Grey shaded area represents predicted cassowary habitat.\
(b) Map of the study area showing the locations of roads and landscape features. The number of sightings and traffic strikes that have occurred are geo-referenced in 1 km grid cells. (from @dwyer_using_2016)

::: {#tbl-descrva}
| Variable name | Ecological reference |
|------------------------------------|------------------------------------|
| `Rainforest.P` (quantitative continue) | proportion of rainforest within the grid |
| `Residential.P` (quantitative continue) | proportion of residential area within the grid |
| `Fruit.P` (quantitative continue) | proportion of fruit crop within the grid |
| `Other.P` (quantitative continue) | proportion of other area (pasture, wetland) within the grid |
| `Total_Road` (quantitative continue) | length of road within the grid |
| `Sightings` (quantitative counting) | visual contact of cassowary |
| `Strikes` (quantitative counting) | mortality of cassowary due to road traffic |
| `Residential.01` (quantitative binary) | presence /absence of residential area |
| `Fruit.01` (quantitative binary) | presence /absence of fruit crop |
| `Dresid` (quantitative continue) | distance of the road to residential area |
| `Dfruit` (quantitative continue) | distance of the road to fruit crop area |

Table of the cassowary variables and their ecological meaning.
:::

To answer the questions, we will first formulate a model with `Sightings` as a response variable to determine which factors influence the species abundance and then analyse the results. Then, we will study another model with `Strikes` as a response variable in order to identify the factors that influence the mortality of cassowary in the studied area and ways to limit it, thinking about a conservation approach.

We note that `Sightings` doesn't represent actual abundances of Cassowaries, but counts made over 20 years by several people who participated in a citizen science program. The number of `Sightings` does not reflect the number of cassowary individuals, but rather the number of observations in each grid-cell of 1 km². Therefore, to answer the main question, we study the influence of factors on a proxy for abundance, where `Sightings` give an idea of cassowary activity and in what context they were observed most often and were therefore most abundant.

In this study, we have several variables linked to the environment as well as the latitude and longitude of each cell (@descrva). Close cells may have similar environmental conditions and that may influence the count of cassowaries. Cassowaries can probably move from a cell to another cell nearby, this can also influence `Sightings`. There are repeated counts in some cells : they were carried out over several years and each year, several citizens came to count in the same patches. Therefore, it is possible that there is spatial correlation between the different cells. The coordinates of the grid-cells centroids will enable us to test for spatial autocorrelation.

**Hypothesis:** *We assume that southern cassowary is mainly distributed near its natural habitat (rainforest) or in areas where food is available (Fruit crop). We expect that high proportions of rainforest and fruit crops are associated with greatest cassowary abundance.*\
*We also assume that traffic strike is higher when the road connects to favorable habitat, with a low distance between fruit crops and road.*

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE, cash = TRUE)
```

**R Libraries**

```{r dowload libraries, message = FALSE, warning = FALSE}
# Models
library(nlme) #glm mixed and gls
library(DHARMa) #diagnostic for lm, glm
library(tidyverse) #for data cleaning, ordering
library(ggplot2)
library(MASS)
# Spatial analysis 
library(geoR) #for spatial object to perform geostatistic
library(sp)
library(sf) #deal with spatial data
library(pgirmess) #for spatial correlogram
library(spdep) #to extracted the neighbors is a spatial data
library(ade4) #used for plotting spatial data
library(spatialreg) #used for spatial data modelling
library(spgwr) #to run geographically weighted regression
library(dplyr)
library(mapview) # maps with openstreetMa
library(corrplot) #correlation plot
library(effects) # ploter les effets des variables
```

# Data

```{r data importation}
cassowary <- read.table("data_cassowary.txt", h = T)
summary(cassowary)
```

```{r data NA}
#Is NA?  
colSums(is.na(cassowary))
```

There is no NA values in our data set

# Abundance of the cassowary

## Data exploration

### Variable distribution

#### Distribution of the response variable Sightings $Y$ {.unnumbered}

```{r data response variable abundance}
#| label: fig-sighting_descr
#| fig-cap: "Distribution of the response variable : Cassowary sightings"

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("blue4", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Sightings,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary observation',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Sightings,
         pch = 16, col = col_transp,
         xlab = 'Cassowary observation',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Sightings,
  col = col_transp,
  border = "white",
  xlab = "Cassowary observation",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Sightings, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(cassowary$Sightings, col='red', lwd=2)
```

Their are some outliers in the distribution of Y (@fig-sighting_descr).

```{r}
table(cassowary$Sightings) 
prop.table(table(cassowary$Sightings)) * 100
```

`Sightings` were obtained thanks to counting : we will probably use a Generalized Linear Model using Poisson distribution to study it.

65% of `Y` values are zeros : it represents a lot of zeros and it may have an influence on the model. The maximum value is really high : 572. The large dispersion of values and the amount of zeros can then influence the model and the way we will formulate it to study `Sightings`.

Cassowaries are rarely and higlty territorial, with approximativly 1 individual/km² (@moore_population_2007). In some cells, some values of `Sightings` are up to 100 counts / km², but it can be normal : as explained before, `Sightings` don't reflect actual abundance of cassowaries but the frequency of observation by citizens.

The data will be discussed because an overcounting by citizens can be possible. Sometimes individuals can be double-counted in the context of a citizen science program. We could then attempt to study `Y` as it is and then limit the counts in certain cells to limit overdispersion and compare different methods.

#### Distribution of environmental variables $X$ {.unnumbered}

We assume that the environmental variables that can influence cassowary abundance are the abundance of a certain type of habitat and the presence/absence of these habitats in cells where cassowaries are counted. We also test if there is a correlation with distances.

-   **Description of quantitative continue variables :**

```{r X abundance variables, fig.show = "hold"}
#| label: fig-distribenv
#| fig-cap: "Distribution of environmental variables"
#| fig-show: hold

env <- cassowary %>%
  dplyr::select(Rainforest.P, Residential.P, Fruit.P, Other.P, Total_Road, 
                Dresid, Dfruit)

par(mfrow = c(2, 2))
for(i in 1:ncol(env)){
  boxplot(env[,i], col = col_transp, border = "gray30", 
          ylab = colnames(env)[i], main = 'Boxplot')
  dotchart(env[,i], pch = 16, col = col_transp, border = "gray30", 
           xlab = colnames(env)[i], main = 'Cleveland plot') 
  hist(env[,i], col = col_transp, border = "gray30", xlab = colnames(env)[i], 
       main = "Histogramm")
  qqnorm(env[, i], pch = 16, col = col_transp, border = "gray30", 
         main = "QQ plot")
  qqline(env[, i], col = 'red', lwd = 2)
}
```

We can note presence of outliers in some covariates (`Residential.P` and `Total_Road`) with high dispersion. Next, we must be careful that this does not skew the model results. If this is the case, we could try a log transformation of these covariates.

-   **Description of quantitative binary variables : Fruit.01 and Residential.01**

```{r}
#Residential.01 : presence/absence of residential area
cassowary$Residential.01 <- as.factor(cassowary$Residential.01)
summary(cassowary$Residential.01)

#Fruit.01 : presence/absence of fruit crop
cassowary$Fruit.01 <- as.factor(cassowary$Fruit.01)
summary(cassowary$Fruit.01)
```

There is a good balance between presence and absence for each variable. However, studying the effect of presence/absence of fruit crop in cells and the effect of proportion of fruit crop in cell in the same model can be redundant. The same can be told for presence/absence of residential area and proportion of residential area within the grid.

### Potential relationships between response variable (Sightings) and explanatory variables

-   **Potential relationships between response variable (Sightings) and quantitative variables :**

```{r}
par(mfrow=c(2, 2))

# Rainforest.P
plot(cassowary$Sightings ~ cassowary$Rainforest.P, pch = 16,
     col = 'olivedrab4', xlab = 'Proportion of rainforest', ylab = 'Sightings')

#Residential.P
plot(cassowary$Sightings ~ cassowary$Residential.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of residential area', ylab = 'Sightings')

# Fruit.P
plot(cassowary$Sightings ~ cassowary$Fruit.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of fruit crop', ylab = 'Sightings')

#Other.P
plot(cassowary$Sightings ~ cassowary$Other.P, pch = 16, 
     col = 'olivedrab4', xlab = 'Proportion of wetlands and pasture', 
     ylab = 'Sightings')


#Total_Road
plot(cassowary$Sightings ~ cassowary$Total_Road, pch = 16, 
     col = 'olivedrab4', xlab = 'Road length inside of the grid', 
     ylab = 'Sightings')


#Dfruit
plot(cassowary$Sightings ~ cassowary$Dfruit, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance between road and fruit crops', 
     ylab = 'Sightings')


#Dresid
plot(cassowary$Sightings ~ cassowary$Dresid, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance between road and residential area', 
     ylab = 'Sightings')
```

-   **Potential relationships between response variable (Sightings) and qualitative variables :**

```{r}
par(mfrow = c(2, 1))
#Residential.01 
boxplot(cassowary$Sightings ~ cassowary$Residential.01, pch = 16,
        col = 'olivedrab4', xlab = 'presence/absence of residential area',
        ylab = 'Sightings')

#Fruit.01
boxplot(cassowary$Sightings ~ cassowary$Fruit.01, pch = 16,
        col = 'olivedrab4', xlab = 'presence/absence of fruit crop',
        ylab = 'Sightings')

```

Using graphs, it seems difficult to see relations between $Y$ and $Xs$. One explanation is that there are a lot of zeros in `Sightings`. Nevertheless, we observe that more cassowary individuals are observed when `Rainforest.P` is higher. The opposite relation is observed between Y and `Other.P`. `Other.P` and `Rainforest.P` could be correlated : we check correlation between $Xs$ in the following section. Regarding `Fruit.P`, it seems that cassowaries are more counted when the proportion of fruit crop is lower but when this proportion is higher, the counts are superior to 0 individuals. We also checked the relation between `Dresid` and `Sightings`, and the relation between `Dfruit` and `Sightings` : no obvious relations appear on graphs but ecologically, we think that `Sightings` is not influenced by `Dfruit` and `Dresid`. We won't test theses two relations.

### Correlation between environmental variables $X$

-   **Collinearity between continuous environmental variables :**

```{r correlation abundance X}
#| label: fig-corrplot
#| fig-cap : "Correlation between environmental variables"
correlation <- cor(env)
corrplot(correlation, type = "upper", method = "number")
```

This @fig-corrplot shows a negative correlation (-0.82) between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`. This result was expected since the habitat proportion variables per cell are constructed together. For the analysis, we will keep `Rainforest.P` : if it influences cassowary abundance, it can be linked directly to the literature.

This @fig-corrplot shows a negative correlation between the proportions of different habitats per cell (notably -0.82 between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`). This result was expected since the habitat proportion variables per cell are constructed together. We also have strong correlations between variables made from the same information : i.e `Residential.01` (presence /absence of residential area),`Residential.P` (proportion of residential area in the grid), and `Dresid` (distance of the road to residential area), or `Fruit.P`, `Fruit.01` and `Dfruit`.

This @fig-corrplot shows a negative correlation between the proportions of different habitats per cell (notably -0.82 between the proportion of rainforest `Rainforest.P` and that of other habitats `Other.P`). This result was expected since the habitat proportion variables per cell are constructed together.

-   **Collinearity between categorical and continuous environmental variables :**

```{r}
#| label: fig-colinea_fruit01
#| fig-cap : "Collinearity between categorical and continuous environmental variables"

par(mfrow=c(2,3))

# Rainforest.P et Fruit.01
boxplot(cassowary$Rainforest.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of rainforest",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Residential.P et Fruit.01
boxplot(cassowary$Residential.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of residential area",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Fruit.P et Fruit.01
boxplot(cassowary$Fruit.P ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Proportion of fruit crop",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Dfruit et Fruit.01
boxplot(cassowary$Dfruit ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Distance between road and fruit crop",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Dresid et Fruit.01
boxplot(cassowary$Dresid ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Distance between road and residential area",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")

#Total_Road et Fruit.01
boxplot(cassowary$Total_Road ~ cassowary$Fruit.01, varwidth = TRUE,
        ylab = "Lenght of road within the grid",
        xlab = "presence/absence of fruit crop", col = 'grey', main = "")


par(mfrow = c(2,3))

# Rainforest.P et Residential.01
boxplot(cassowary$Rainforest.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion de Rainforest",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Residential.P et Residential.01
boxplot(cassowary$Residential.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion of residential area",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Fruit.P et Residential.01
boxplot(cassowary$Fruit.P ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Proportion of fruit crop",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Dfruit et Residential.01
boxplot(cassowary$Dfruit ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Distance between road and fruit crop",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Dresid et Residential.01
boxplot(cassowary$Dresid ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Distance between road and residential area",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

#Total_Road et Residential.01
boxplot(cassowary$Total_Road ~ cassowary$Residential.01, varwidth = TRUE,
        ylab = "Lenght of road within the grid",
        xlab = "presence /absence of residential area", col = 'grey', main = "")

```

There is a positive correlation between the data on the presence/absence of fruit crops `Fruit.01` and the proportion of fruit crops within the grid `Fruit.P` (as well as for the presence/absence of residential areas `Residential.01` and the proportion of residential areas within the grid `Residential.P`). This result is also expected because these variables highlight similar information. It will therefore be necessary in the subsequent analysis to choose which environmental variables to select in order to avoid them being too correlated.

### Analysis of possible interactions between variables $X$

```{r}
par(mfrow=c(2,2)) 

# Interactions between Rainforest.P & Fruit.01 ---------------------------------
plot(cassowary$Sightings ~ cassowary$Rainforest.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of rainforest")
points(cassowary$Sightings[cassowary$Fruit.01 == "0"] ~ cassowary$Rainforest.P[cassowary$Fruit.01 == "0"], 
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(cassowary$Sightings[cassowary$Fruit.01 == "1"] ~ cassowary$Rainforest.P[Fruit.01 == "1"], 
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions between Rainforest.P & Residential.01 ---------------------------
plot(Sightings ~ Rainforest.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of rainforest", data = cassowary)
points(Sightings[Residential.01 == "0"] ~ Rainforest.P[Residential.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Residential.01 == "1"] ~ Rainforest.P[Residential.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions between Residential.P & Fruit.01 --------------------------------
plot(Sightings ~ Residential.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of residential area", data = cassowary)
points(Sightings[Fruit.01 == "0"] ~ Residential.P[Fruit.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Fruit.01 == "1"] ~ Residential.P[Fruit.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 

# Interactions beteween Fruit.P & Residential.01 -------------------------------
plot(Sightings ~ Fruit.P, type = 'n',
     ylab = "Sightings", xlab = "Proportion of fruit crop", data = cassowary)
points(Sightings[Residential.01 == "0"] ~ Fruit.P[Residential.01 == "0"],
       pch = 16, col = 'darkolivegreen4', data = cassowary) 
points(Sightings[Residential.01 == "1"] ~ Fruit.P[Residential.01 == "1"],
       pch = 17, col = 'darkorchid', data = cassowary) 
```

We could test interactions in the model if necessary but don't really wan't to include `Residential.01` and `Fruit.01` in the model.

### Observations regarding spatial data with cartography

```{r spatial configuration}
#| label: fig-1rstcarto_cells
#| fig-cap: "First view of grid-cells distribution"

plot(cassowary[,2:3])
```

The points are distributed continuously, even if some locations are missing (@fig-1rstcarto_cells).

By projecting the locations onto an OpenStreetMap, to look closer :

```{r}
#| label: fig-carto_cells
#| fig-cap: "Map of presence / absence of Cassowary seen on the grid-cells"

cassow_sf <- cassowary %>% 
  mutate(abs = ifelse(Sightings == 0, "abs", "pres"), 
         morta = ifelse(Strikes == 0, "pas_morta", "morta")) %>%
  st_as_sf(., coords = c("longitude", "latitude"), crs = "EPSG:28355")  

cassow_sf %>% 
  mapview(zcol = "abs", layer.name = "Cassowary sightings", 
          map.types = c("OpenStreetMap.DE"))
```

The grid-cells are distributed evenly throughout the space, but follow the layout of the roads : therefore, there are no cells in the middle of the rainforests.\
The difference in the extent of rainforests between the OpenStreetMap base map (@fig-carto_cells) and that of the article is probably due to the time difference between the sources.

```{r}
#| label: fig-carto_pabs
#| fig-cap: "Map of Cassowary abundance on the grid-cells"

mapview(cassow_sf %>% filter(abs == "abs"), 
        zcol = "abs", col.regions = "white", layer.name = "Absence", 
        map.types = c("OpenStreetMap.DE")) + 
  mapview(cassow_sf %>% filter(abs == "pres"), 
          zcol = "Sightings", layer.name = "Abondance", 
          map.types = c("OpenStreetMap.DE"))
```

This map shows that cassowary sightings tend to be more common in the rainforest part (@fig-carto_pabs).

```{r}
#| label: fig-carto_collision
#| fig-cap: "Map of the number of collisions recorded"

mapview(cassow_sf %>% filter(morta == "pas_morta"), 
        zcol = "Strikes", col.regions = "white", 
        layer.name = "No traffic strikes recorded", 
        map.types = c("OpenStreetMap.DE")) + 
  mapview(cassow_sf %>% filter(morta == "morta"), 
          zcol = "Strikes", layer.name = "Number of traffic strikes recorded", 
          map.types = c("OpenStreetMap.DE"))
```

The mortality strike occur on the road near the rainforest and where cassowaries appear to be abundant.

With these observations and the collinearity observed before, we can keep `Rainforest.P` instead of `Other.P`for the model. It can have more direct signification while formulating the model.

------------------------------------------------------------------------

## Statistical Analysis

### Spatial dependency: semi-variogramm

**a.) Without any modification of the data:**

First, we have to investigate if there is spatial dependency in the variables and because this is a continuous process, we are going to visualize the semi-variograms. For this first model, related to the first problematic **"Which factors influence the southern cassowary abundance?"** we do not take into account `Strikes` and the variables directly linked to the road (`Total_Road`, `Dresid`&`Dfruit`).

```{r}
geo_sight <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                               data.frame(cassowary$Sightings)))
#geo_residb <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),data.frame(cassowary$Residential.01)))
#geo_fruitb <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),data.frame(cassowary$Fruit.01)))
geo_rainp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                               data.frame(cassowary$Rainforest.P)))
geo_residp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Residential.P)))
geo_fruitp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Fruit.P)))
geo_otherp <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]),
                                                data.frame(cassowary$Other.P)))
```

In order to plot the semi variance plot (semi-variogram) for the variables, especially the respond variable, we need to look at the distribution of distance between points.

```{r}
hist(dist(cassowary[,2:3]))
```

We can see that 95% of the distance are under 25 000, 30 000 meters.

```{r semivar}
#| label: fig-semivario
#| fig-cap: "Empirical semi variogram for sightings of cassowary"

semivar_sight <- variog(geo_sight, option = "bin", max.dist = 30000, messages = FALSE)
semivar_rain <- variog(geo_rainp, option = "bin", max.dist = 30000, messages = FALSE)
#semivar_residb <- variog(geo_residb, option = "bin", max.dist = 30000, messages = FALSE)
#semivar_fruitb <- variog(geo_fruitb, option = "bin", max.dist = 30000, messages = FALSE)
semivar_residp <- variog(geo_residp, option = "bin", max.dist = 30000, messages = FALSE)
semivar_fruitp <- variog(geo_fruitp, option = "bin", max.dist = 30000, messages = FALSE)
semivar_otherp <- variog(geo_otherp, option = "bin", max.dist = 30000, messages = FALSE)

par(mfrow = c(1, 1))
plot(semivar_sight, main = "Sightings of cassowary")
```

```{r semivar}
#| label: fig-semivario2
#| fig-cap: "Empirical semi variogram for environmental variables"

par(mfrow = c(2, 2))
plot(semivar_rain, main = "Proportion of rainforest")
#plot(semivar_residb, main = "Presence/absence of residential area")
#plot(semivar_fruitb, main = "Presence/absence of fruit crop")
plot(semivar_residp, main = "Proportion of residential area")
plot(semivar_fruitp, main = "Proportion of fruit crop")
plot(semivar_otherp, main = "Proportion of other")
```

As we can see on all the plots of @fig-semivario, except maybe for the semi-variogram for presence/absence of residential area, **the values between points seem to become less similar when distance increases until it reaches 15 000 or 20 000 meters** because from this point, the variance seems to decrease and so points start becoming more similar again. On the semi-variogram for proportion of fruit crop, we can even see 2 maxima.

As we can see on all the plots, except maybe for the semi-variogram for presence/absence of residential area, the values between points seem to become less similar when distance increases until it reaches 15 000 or 20 000 meters because from this point, the variance seems to decrease and so points start becoming more similar again. On the semi-variogram for proportion of fruit crop, we can even see 2 maxima.

These types of graphs are usually typical of a **periodic phenomenon**, also known as **patches or clusters**, however, here we did not apply any transformation on the data. In fact, `Sighthings` are counting data (Poisson law), `Residential.P` and `Fruit.P` present a lot of zeros (zero-inflated method), `Residential.01` and `Fruit.01` are presence/absence data (binary).

This is an important thing to consider because behind the variogram, there are 2 fundamental assumptions valid for any location, also known as the second-order stationarity : the stationarity of the expected value and the stationarity of the covariance (covariance between two points depends only on the spatial shift of vector `h`, and not on the absolute positions). These assumptions presuppose a certain spatial homogeneity of the phenomenon under study, which is not the case by default for our variables of interest (for instance, for counting data, the variance increases linearly with the mean).

```{r}
#| label: correlograms
#| fig-cap: "Correlograms for environmental variables"

plot(correlog(cassowary[,2:3], cassowary$Sightings, method = "Moran", nbclass = 12),
     main = "Correlogram of Sightings")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Rainforest.P, method = "Moran", nbclass = 12),
     main = "Correlogram of Rainforest proportion")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Residential.P, method = "Moran", nbclass = 12),
     main="Correlogram of Proportion of residential area")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Residential.P, method = "Moran", nbclass = 12),
     main="Correlogram of Proportion of fruit crop")
abline(h = 0, lty = 2)

plot(correlog(cassowary[,2:3], cassowary$Total_Road, method = "Moran", nbclass = 12),
     main="Correlogram of the length of the road")
abline(h = 0, lty = 2)
```

These correlograms are based on Moran's index. High values are positively correlated with each other. The red dots are significant correlations. Most variables show autocorrelation up to 7 km.

### GLM with Poisson Distribution
As we have count response data (i.e quantity of events), we used **generalised linear models** (GLMs) with a **Poisson** distribution and a log link function (@mohammed2025spatial).\
$Sightings$ \~ $P(\lambda)$, with $\lambda$, the expectation and variance rate of events. Here, variance increases linearly with the mean.\
With the log link function : $log(\lambda_i) = \alpha + \beta_iX_i + \varepsilon_{i}$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient represnting the effect of each independant variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables\
Here, we model $log(\lambda_i) = \alpha + \beta_1Raiforest_i + \beta_2Residential.P_i + \beta_3Fruit.P_i + \varepsilon_{i}$

Some informations are redundant and correlated (@fig-corrplot) : we remove the variables `Residential.01` and `Fruit.01` (redundant with `Residential.P` and `Fruit.P`) and `Other.P` (correlated to `Rainforest.P`).

```{r}
glm_pois1 <- glm(Sightings ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, 
                 data = cassowary, 
                 family = poisson(link="log"))
summary(glm_pois1)
```

-   **Overdispersion check (scale parameter calculation) :**\
    *Overdispersion means that that residual variance is larger than expected under the fitted model. If overdispersion is present, confidence intervals will tend to be too narrow, and p-values too small, leading to inflated type I error. This phenom is most common for GLM families with constant dispersion, such as Poisson models. (@dharma_hartig)*

```{r}
simout <- simulateResiduals(fittedModel = glm_pois1, plot = F)
plot(simout)
```

Here, there is overdispersion, it can be due to outliers, model misfit, missing interactions and zero-inflation.

```{r}
testDispersion(simout)
testZeroInflation(simout)
```
Dharma test shows also zero-inflation (a situation when more zeros appear in the observation than expected under the fitted model).

-   Ratio residual deviance / ddl $\phi$ :   
It allows us to estimate whether the actual variance of the observations is not too far from the theoretical variance : $\phi = \frac{\text{variance observed}}{\text{theoretical variance}} = \frac{residual deviance}{number of degrees of freedom}$    
If this ratio is greater than 1, then there is overdispersion. It is based on log-likelihood and is less sensitive to extreme points.
```{r}
#based on the results of glm_pois1
8807.7/250
```
Here, there is overdispersion.

-   Pearson residuals :
```{r}
E1 <- resid(glm_pois1, type = "pearson") # (Y - mu) / sqrt(mu)
N  <- nrow(cassowary)
p  <- length(coef(glm_pois1))
sum(E1^2) / (N - p)
```
Here, the Pearson residuals are way above 1, so there is overdispersion.

### GLM with Negative Binomial Distribution

To account for the overdispersion of the residuals, we switch to a GLM with a **Negative binomial** distribution, with a log link function. $Sightings$ \~ $NB(\mu, \phi)$, with $\mu$ the mean of the distribution, and $\phi$ the dispersion parameters.\
With the log link function : $log(\mu_i) = \alpha + \beta_iX_i + \varepsilon_{i} = \eta$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independant variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables Here, we model $log(\mu_i) = \alpha + \beta_1Raiforest_i + \beta_2Residential.P_i + \beta_3Fruit.P_i + \varepsilon_{i}$

```{r}
glm_NB <- glm.nb(Sightings ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, data = cassowary)
summary(glm_NB)
```

-   **Overdispersion check (scale parameter calculation) :**\
-   Ratio residual deviance / ddl :

```{r}
173.48/249
```

Here, the ratio \< 1 : there is no overdispersion.

-   Residus de Pearson :
```{r}
E1 <- resid(glm_NB, type = "pearson") # (Y - mu) / sqrt(mu)
N  <- nrow(cassowary)
p  <- length(coef(glm_NB))
sum(E1^2) / (N - p)
```

-   Dharma test :
```{r}
simout_NB <- simulateResiduals(fittedModel = glm_NB, plot = F)
plot(simout_NB)
testZeroInflation(simout_NB)
```

No more overdispersion : the negative binomial distribution seems appropriate in this case. If this had not been the case, we would have considered other distributions, such as the one that include zero-inflation (i.e. a situation when more zeros appear in the observation than expected under the fitted model).

Write the results of model

```{r}
geo_resid <- as.geodata(SpatialPointsDataFrame(data.frame(cassowary[,2:3]), 
                                               data.frame(E1)))
semivar_resid <- variog(geo_resid, option = "bin", max.dist = 30000)
plot(semivar_resid, main = "Semi-variogramme des résidus NB")
```

We still have an abnormal semi variogram ??? A préciser

-   **Spatial autocorrelation check :**\
Since we have spatial data, we need to check whether there is any spatial dependence between observations by looking for spatial autocorrelation in the model residuals, with Moran test (@dharma_hartig).

```{r}
# Dharma procedure :
testSpatialAutocorrelation(simulateResiduals(glm_NB), 
                           x = cassowary$longitude, y = cassowary$latitude)
```

For each point, we have a local Moran index.\
Here, the observed Moran's index is higher than the expected. This indicates a tendency towards clustering. We have significant positive autocorrelation (p-value \< 2.2e-16) : this means that two observations that are close together are more likely to be similar than two observations that are far apart. In the case of a stationary process, the residuals are spatially random, however here the intensities and the colours of the points vary a lot which is a sign of a global non-stationarity of the relationship between `Sightings` and the explanatory variables.

-   **First visualisation of result :**\
    Even if our model is not correct because of spatial autocorrelation, we can still visualize the predictors of the Negative Binomial GLM.
```{r}
#|label: plot_alleffects
#|fig-cap: "Predictor effects on Sightings"

plot(allEffects(glm_NB), ci.style = "bands")
```

It shows the effects plotted on the scale of the linear predictor, but the vertical axis is labelled on the response scale. This preserves the linear structure of the model while permitting interpretation on what is usually a more familiar scale (ref)

### Geostatistical model GWR

In the previous models, we have strong spatial autocorrelation. The GWR model can allow us to take **local** spatial dependence into account. For each observation, a regression is fitted only based on the localized neighborhood, so we obtain one intercept and one estimate for each point.

We define the *SpatialPointsDataFrame* with both variables and coordinates and we optimize the bandwidth for the kernel function. I tried to use a GGWR rather than a GWR because, like we saw, the Negative binomial model seem to be the most appropriate one. However, the ***bw.ggwr*** and ***gwr.generalised*** functions didn't work as expected (a lot of problems I didn't know how to solve). We try to use log(Y+1) transformation on the response variable in a general linear model and then the ***gwr*** function.

**GWR because of the non-stationarity** : I tried to use a GGWR rather than a GWR because, like we saw, the Negative binomial model seem to be the most appropriate one. However, the ***bw.ggwr*** and ***gwr.generalised*** functions didn't work as expected (a lot of problems I didn't know how to solve). So, here I simply used the log(y+1) transformation on the response variable and the ***gwr*** function for general linear models.

#### A study of log(Sightings + 1) as the response variable

-   **Distribution of Y_1 = log(Sightings + 1)**
```{r Y1}
cassowary$Y_1 = log(cassowary$Sightings + 1)

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("blue4", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Y_1,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary observation',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Y_1,
         pch = 16, col = col_transp,
         xlab = 'Cassowary observation',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Y_1,
  col = col_transp,
  border = "white",
  xlab = "Cassowary observation",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Y_1, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(cassowary$Y_1, col='red', lwd=2)
```
Still a lot of zeros... Le log ne règle pas le problème des zéros.

We try to fit the model with the sames variables as in the previous glm.

```{r model lm}
try_linear = lm(Y_1 ~ Rainforest.P + Residential.P + Fruit.P + Total_Road, data = cassowary)
summary(try_linear)
```

This leads to make the distribution of the response closer to a Gaussian, allowing the use of classical GWR (gwr) on a linear model.

Etudier le R² ajusté ?

-   **Residuals normality :**  
```{r ResidNorm, include=TRUE, fig.height=4, fig.width=6}
par(mfrow=c(1,2))
# Histogram
hist(try_linear$residuals,col='blue3',xlab="residuals",main="Check Normality")
# Quantile-Quantile plot
qqnorm(try_linear$residuals,pch=16,col='blue3',xlab='')
qqline(try_linear$residuals,col='red',lwd=2)
```

-   **Homoscedasticity :**  
```{r Residhomo, include=TRUE, fig.height=3, fig.width=6}
par(mfrow=c(1,3))

# residuals vs fitted
plot(residuals(try_linear)~fitted(try_linear)
      , col='blue3'
      , pch=16)
abline(h = 0)

# residuals against Rainforest.P
plot(residuals(try_linear)~ cassowary$Rainforest.P, 
         pch=16,
         col="blue3",
         ylab = "Residuals",
         xlab = "Rainforest.P",
         main = "")
abline(h = 0)
```

No comment...

-   **Spatial autocorrelation test :**  
```{r}
# Dharma procedure :
testSpatialAutocorrelation(simulateResiduals(try_linear), 
                           x = cassowary$longitude, y = cassowary$latitude)
```
Presence of spatial autocorrelation

#### GWR Model
To apply the GWR model, we have to define the SpatialPointsDataFrame with both variables and coordinates in an object called `geocass.` At this stage, we also optimize the bandwidth (a metric that represents a distance between points or the number of neighbors used in each regression) for the kernel function (neighborhood weighting function) and then we run the GWR model. The determination of the bandwith is actually based on the spatial autocorrelogram and most notably, the influence of the neighbors is weighted by a decreasing function of distance.
```{r}
geocass <- SpatialPointsDataFrame(data.frame(cassowary[,2:3]), 
                                  data.frame(cassowary[,c("Rainforest.P","Residential.P","Fruit.P", "Total_Road", "Sightings")]))

gwr.bw <- gwr.sel(log(Sightings+1) ~ Rainforest.P + Residential.P + Fruit.P + Total_Road,
                  data = geocass, adapt = FALSE)
lmgwrD <- gwr(log(Sightings+1) ~ Rainforest.P + Residential.P + Fruit.P + Total_Road,
              data = geocass, bandwidth = gwr.bw, se.fit = T, hatmatrix = T)
summary(lmgwrD)
```

The main interesting output is the SDF : the variables (intercept) and `Rainforest.P`, `Residential.P`, `Fruit.P` and `Total_Road`give the regression coefficients.\
`Intercept.se` and `Rainforest.P_se`, `Residential.P_se`, `Fruit.P_se` and `Total_Road_se`give the coefficient standard errors.

```{r}
names(lmgwrD$SDF)
```

Since it is a spatial object we can map the coefficient and their significativity. Significativity of coefficient is not automatically computed by R, but, we can use the coefficient and their standard error to get a t-statistic. Under the null hypothesis, the t ratio follows a t distribution, and hence one can calculate the probability. To do this, first get the degrees of freedom from the gwr results object. For instance, we can test the significativity of the parameters.

#### Getting the statistics for the GWR model

```{r}
dfree <- lmgwrD$results$edf

vars <- c("Rainforest.P", "Residential.P", "Fruit.P", "Total_Road")

gwr_signif_all <- lapply(vars, function(v) {
  
  # Coefficient and standard error for the variable v
  beta <- lmgwrD$SDF[[v]]
  se <- lmgwrD$SDF[[paste0(v, "_se")]]
  
  # Statistics
  t_val <- beta / se
  p_val <- 2 * (1 - pt(abs(t_val), df = dfree))
  
  # Classes
  classe_beta <- ifelse(beta < 0, "negative",
                        ifelse(beta > 0, "positive", "zero"))
  
  classe_p <- ifelse(p_val < 0.05, "p<0.05", "p>0.05")
  
  # Local Data frame 
  data.frame(variable = v, x = coordinates(geocass)[,1], y = coordinates(geocass)[,2],
    beta = beta, se = se, t = t_val, p = p_val,
    classe_beta = classe_beta, classe_p = classe_p)
}) %>% bind_rows()
```

#### Visualization of the GWR local coefficients for each variable

```{r}
 ggplot(gwr_signif_all %>% filter(variable == "Rainforest.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p<0.05" = "red", "p>0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw() +
  ggtitle("GWR local coefficients for Rainforest.P")
```

```{r}
ggplot(gwr_signif_all %>% filter(variable == "Residential.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p<0.05" = "red", "p>0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw() +
  ggtitle("GWR local coefficients for Residential.P")
```

```{r}
ggplot(gwr_signif_all %>% filter(variable == "Fruit.P"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p<0.05" = "red", "p>0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw() +
  ggtitle("GWR local coefficients for Fruit.P")
```

```{r}
ggplot(gwr_signif_all %>% filter(variable == "Total_Road"),
  aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  scale_color_manual(values = c("p<0.05" = "red", "p>0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17, "zero" = 15)) +
  scale_size_continuous(range = c(1, 8)) +
  theme_bw() +
  ggtitle("GWR local coefficients for Total_Road")
```

#### Visualization of all the GWR local coefficients at the same time

```{r}
#To visualize all the variables in a single window : 
ggplot(gwr_signif_all,
       aes(x = x, y = y, color = classe_p, shape = classe_beta, size = beta)) +
  geom_point() +
  facet_wrap(~ variable, scales = "free") +
  scale_color_manual(values = c("p<0.05" = "red", "p>0.05" = "blue")) +
  scale_shape_manual(values = c("positive" = 16, "negative" = 17)) +
  theme_bw() +
  ggtitle("Local Maps of GWR coefficients (Sightings log transformed)")
```

## Results

The relationship between `Sightings` and `Fruit.P`, `Residential.P` and `Total_Road` mostly translates very well significantly to the Northeast whereas the significant effect of `Rainforest.P` is more widespread spatially. Where the effects of the variables are significant, they are also mainly positive. Even if the interpretation on the log scale is not very intuitive, we can still say that locally the greater the proportion of fruit crops, residential areas, rainforest and the larger the total road area within the grid, the greater the abundance of cassowary. The variables that seem to have the most impact (greater coefficients) on the abundance of cassowary are `Fruit.P`, `Residential.P` and `Rainforest.P.` These results validate the hypothesis made when including the explanatory variables into the first model : the abundance of cassowary is mainly regulated by the proportion of fruit crop available because it represents a source of food and the proportion of rainforest because cassowary mostly need forest as a natural habitat. The results we have for the effects of proportion of residential area and total road rather differ from the assumptions we made : this could be due to an observation bias we usually find in participative science studies. In fact, areas more populated by humans are also those where humans are more likely to report the presence of cassowary because humans explore less the forest or fruit crops where cassowary abundance is directly linked to the ecology of the species.

## Discussion

# Mortality of cassowary

## Data exploration

### Distribution of variables

#### Distribution of the response variable Strikes $Y$ {-}

```{r data response variable mortality}
#| label: fig-strikes_descr
#| fig-cap: "Distribution of the response variable : Cassowary strikes"

par(mfrow = c(2, 2),
    mar = c(4, 4, 2, 1),
    bg = "gray95",
    col.axis = "gray20",
    col.lab = "gray20",
    col.main = "gray20",
    cex.axis = 0.9,
    cex.lab = 1) 
col_transp <- adjustcolor("aquamarine3", alpha.f=0.5) 

# Boxplot ----------------------------------------------------------------------
boxplot(cassowary$Strikes,
        col = col_transp, border = "gray30",
        ylab = 'Cassowary mortality',
        main = 'Boxplot',
        notch = F) 

# Cleveland plot ---------------------------------------------------------------
dotchart(cassowary$Strikes,
         pch = 16, col = col_transp,
         xlab = 'Cassowary mortality',
         main = 'Cleveland plot',
         cex = 0.8)

# Histogram --------------------------------------------------------------------
hist(cassowary$Strikes,
  col = col_transp,
  border = "white",
  xlab = "Cassowary mortality",
  main = 'Histogram',
  breaks = 20)

# Quantile-Quantile plot -------------------------------------------------------
qqnorm(cassowary$Strikes, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(cassowary$Strikes, col='red', lwd=2)
```

```{r}
table(cassowary$Strikes) 
prop.table(table(cassowary$Strikes)) * 100
```

Their is some outliers values in the strike distribution (@fig-stikes_descr). Most of values stop to 5 strikes on a grid cell, but their is one with 13 strikes listed. As we don't have any information on the temporal observation, we will keep all values in the model. As for the `Sightings` variable, `Strikes` are counted, and we will use a Generalized Linear Model with a Poisson distribution.

84% of `Y` values are zeros, with a potential influence on the model.

The data will be discussed because an overcounting by citizens can be possible. Sometimes strikes can be double-counted in the context of a citizen science program.

#### Distribution of environmental variables \$\$X\$ {-}

We assume that all road-related variables influence cassowary strike mortality. As cassowaries have a territory of about 1km² we assume that their chances to encountering a road are high if they live close to one. We also include abundance in the model, as strike mortality may also depend on abundance. By using `Sightings`, we can do a log-transformation because there are outliers in the distribution of `Sightings`.

```{r}
cassowary$LogSightings <- log(cassowary$Sightings +1)
```

```{r X road variables, fig.show = "hold"}
#| label: fig-distribmort
#| fig-cap: "Distribution of strikes explain variables"

road <- cassowary %>%
  dplyr::select(Total_Road, Dresid, Dfruit, Sightings, LogSightings)

par(mfrow = c(2, 2))
for(i in 1:ncol(road)){
  boxplot(road[,i], col = col_transp, border = "gray30", 
          ylab = colnames(road)[i], main = 'Boxplot')
  dotchart(road[,i], pch = 16, col = col_transp, border = "gray30", 
           xlab = colnames(road)[i], main = 'Cleveland plot') 
  hist(road[,i], col = col_transp, border = "gray30", 
       xlab = colnames(road)[i], main = "Histogramm")
  qqnorm(road[, i], pch = 16, col = col_transp, border = "gray30", 
         main = "QQ plot")
  qqline(road[, i], col = 'red', lwd = 2)
}
```

We will keep the log+1 transformation of the variable `Sigthings` as without the transformation their is a lot of outlier in the variable.

### Potential relationships between response variable (Strikes) and explanatory variables

```{r}
par(mfrow=c(3, 2))

# Total_Road
plot(cassowary$Strikes ~ cassowary$Total_Road, pch = 16,
     col = 'olivedrab4', xlab = 'Length of road within the grid', ylab = 'Strikes')

# Dresid
plot(cassowary$Strikes ~ cassowary$Dresid, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance of the road to residential area', ylab = 'Strikes')

# Dfruit
plot(cassowary$Strikes ~ cassowary$Dfruit, pch = 16, 
     col = 'olivedrab4', xlab = 'Distance of the road to fruit crop', ylab = 'Strikes')

# Sightings
plot(cassowary$Strikes ~ cassowary$Sightings, pch = 16, 
     col = 'olivedrab4', xlab = 'Abundance', 
     ylab = 'Strikes')

# LogSightings
plot(cassowary$Strikes ~ cassowary$LogSightings, pch = 16, 
     col = 'olivedrab4', xlab = 'Log Abundance', 
     ylab = 'Strikes')
```

It seems that their is an interaction between the `LogSightings` and `Strikes`.

### Correlation between environmental variables $X$

-   **Collinearity between continuous environmental variables :**

```{r correlation mortality X}
#| label: fig-corrplot_strikes
#| fig-cap : "Correlation between explain variables for strikes"
corelation <- cor(road)
corrplot(corelation, type = "upper", method = "number")
```

There is a correlation between `Sightings` and `LogSightings` but we will just keep the log+1 transformation in the model.

## Statistical Analysis

### Spatial dependency 

```{r}
#| label: correlograms2
#| fig-cap: "Correlograms for road link variables and sightings"

plot(correlog(cassowary[, 2:3], cassowary$Strikes, method = "Moran", nbclass = 12),
     main = "Correlogram of Strikes")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Total_Road, method = "Moran", nbclass = 12),
     main = "Correlogram of Total road")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Dresid, method = "Moran", nbclass = 12),
     main = "Correlogram of distance to the residential area")
abline(h = 0, lty = 2)
plot(correlog(cassowary[, 2:3], cassowary$Dfruit, method = "Moran", nbclass = 12),
     main = "Correlogram of distance to the fruit crops")
abline(h = 0, lty = 2)
plot(correlog(cassowary[,2:3], cassowary$Sightings, method = "Moran", nbclass = 12),
     main = "Correlogram of Sightings")
abline(h = 0, lty = 2)
```

As for the first problematic, we analyse spatial dependency with correlograms based on Moran's index (@correlograms2). The high values mean that dot are correlated with each other and the red one are significant correlation. For the `Strikes` and `Sightings` variables, their is the same correlogram because strikes can occur only if their is cassowary, and values are auto correlated until 7km that probably correspond the cassowaries re partition area.

### GLM with Poisson Distribution

As we have count response data (i.e quantity of events), we used **generalized linear models** (GLMs) with a **Poisson** distribution and a log link function (@mohammed2025spatial).\
$Strikings$ \~ $P(\lambda)$, with $\lambda$, the expectation and variance rate of events. Here, variance increases linearly with the mean.\
With the log link function : $log(\lambda_i) = \alpha + \beta_iX_i + \varepsilon_{i}$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independent variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables\
Here, we model $log(\lambda_i) = \alpha + \beta_1TotalRoad_i + \beta_2Dresid_i + \beta_3Dfruit_i + \beta4log(Sightings+1) +\beta \varepsilon_{i}$\
Since some explanatory variables had different scales, we scaled them (*scale* function). However, in order to be able to compare the effects of the variables with each other, we only centred them (*scale = F)* without reducing them.

```{r}
glm_pois_strikes <- glm(Strikes ~ scale(Total_Road, scale = F) + 
                          scale(Dresid, scale = F) + scale(Dfruit, scale = F) + LogSightings,
                data = cassowary, 
                family = poisson(link ="log"))
summary(glm_pois_strikes)
```

-   **Overdispersion check :**   
```{r}
simrespois <- simulateResiduals(glm_pois_strikes)
testDispersion(simrespois)
testZeroInflation(simrespois)
plot(simulateResiduals(glm_pois_strikes))
```
With the Poisson distribution, residuals are overfitted. So we switch to a Negative Binomial distribution. To test the zero-inflation and the dispersion, we also apply the function implemented in DHARMa package (@dharma_hartig). The result of the dispersion is significant.

### GLM with Negative Binomial distribution

To account for the overdispersion of the residuals, we switch to a GLM with a **Negative binomial** distribution, with a log link function. $Strikings$ \~ $NB(\mu, \phi)$, with $\mu$ the mean of the distribution, and $\phi$ the dispersion parameters.\
With the log link function : $log(\mu_i) = \alpha + \beta_iX_i + \varepsilon_{i} = \eta$\
with :\
- $\alpha$ the intercept,\
- $\beta$ the coefficient representing the effect of each independant variables on $\lambda$,\
- $\varepsilon$ the residuals,\
- $X_i$ the independent variables Here, we model $log(\mu_i) = \alpha + \beta_1TotalRoad_i + \beta_2Dresid_i + \beta_3Dfruit_i + \beta_4log(Sightings_i+1)+ \varepsilon_{i}$

```{r}
glm_nb_strikes <- glm.nb(Strikes ~ scale(Total_Road, scale= F) + 
                           scale(Dresid, scale = F) + scale(Dfruit, scale = F) + 
                           LogSightings, 
                         data = cassowary)
summary(glm_nb_strikes)
```

```{r}
glm <- stepAIC(glm_nb_strikes, direction = "backward") 
```

With the step AIC we choose the best model. We keep the one with the three variables `LogSightings`, `Dfruit` and `Total_Road` even if the last two variables are not significant. The difference between the AIC is just from 2, and with the issues with the `Y` variable, we prefer to keep the more complex model to explain strike mortality.

```{r}
glm_nb_strikes <- glm.nb(Strikes ~ scale(Total_Road, scale = F) + 
                           scale(Dfruit, scale = F) + LogSightings,
                         data = cassowary)
summary(glm_nb_strikes)
```

-   **Overdispersion check :**
```{r}
simresnb <- simulateResiduals(glm_nb_strikes)
testDispersion(simresnb)
plot(simulateResiduals(glm_nb_strikes))
testZeroInflation(simresnb)
```
With the negative binomial distribution, there is no more overfitting in the residuals (@dharma_hartig). The model respect the assumption on the residuals.

-   **Spatial autocorrelation check :**\
    Since we have spatial data, we need to check whether there is any spatial dependence between observations by looking for spatial autocorrelation in the model residuals, with Moran test (@dharma_hartig).

```{r}
testSpatialAutocorrelation(simulateResiduals(glm_nb_strikes), 
                           x = cassowary$longitude, y = cassowary$latitude)
```
Their is no spatial autocorrelation in this model.

## Discussion

Several models have been test, and the one selected is... \
The models show that cassowary abundances are higher when the landscape matrix is mostly compose of rainforest, their natural habitat. There is also a link with the crop fruit and must be from the abundance at least (number of model) for the cassowary to find sustainable resources. The presence of road impact also the presence of cassowary and the abundance tend to decrease when this variable increase. Blabla on this model. \
(je sais pas vraiment quoi dire sur ce modèle vu que pas encore les résultats).

As for the first hypothesis, the first model test was a GLM with a Poisson distribution. The residuals were overfitted with dispersion so we change for a NB model to solve this issue. With this model, all assumption on the residuals were validated. We choose to change for a NB model instead of a quasi-Poisson one because residuals assumptions checking of this semi-parametric distribution are not implemented into DHARMa package. After selected the best NB model, the spatial dependency have been check with a Moran test that appears non significant. \
As expected, the strike mortality is link with the presence of cassowary in the grid cell. More their is individuals, more their is a risk of collision with a car. The distance of the road of fruit crop is not significant but is important to take into consideration as is the only one negative parameter in the model meaning that more fruit crops are far from the road, less is the strike mortality. Some sources for comparison. The total length of the road appears also non significant in the final model but it is logical that more their is road in a grid cell, more the probability to encounter a cassowary on the road is higher en then to have a collision. Comparison with sources.

For both `Sightings` and `Strikes` variables, data was collected by citizen and sum over the entire period of this program. One individual can be count several times as well as a dead one. As cassowary have a territory around 1km², it is possible that all cassowaries seen in the same grid cell was actually one individual. Indeed as we don't have information on individual identity we can not conclude on the real abundance of cassowary, and just make supposition of their habitat. Moreover, most of data was collected across the road and not deeper in the rain forest making the abondances difficult to apprehend. Indeed, it it possible that most individuals have been see close to a road frequently used, and so their probability to be see is higher even in a 20 years period of data collected. \
The lack of information on the temporal observation cause also an issue in the analysis. If a strike was report, we cannot say if on this grid cell an observation of a new cassowary was report or not after the death. For cell where high abundances and high strikes mortality was report, we cannot say if a new individual have been report after the strike on the grid cell. If it was, it is probably a new individual that have colonized the lack territories. But if it wasn't, we report several time one individual, making problem in the model and the hypothesis of cassowary favorable habitat and strikes.

To conclude, our results should be treated with caution as they are based on citizen science data. Indeed, our models are probably not quite adapted to this type of data, that demand a lot of precaution to analyse. Indeed, the model for the spatial autocorrelation in the estimation of cassowary abundance is not appropriate to the data Poisson distribution and it is not recommand to apply a log transofrmation on the Y vairable. A GLMM model with ... should be better for this study. Furthermore, in the initial study (@dwyer_using_2016), each cassowary sighting and strike is dated, allowing for temporal analyses that take sampling bias into account.

To avoid strike mortality the best is to limit road construction and deforestation and making wildlife crossing. Wildlife crossing could decrease fragmentation as well as road collision so it is one of the best solution currently. Best is to not destroy nature anymore but see the COP30 and UE decisions :')...

# Study limitations

-   Information manquante sur les stratégies d’échantillonnage

-   Difficulté d’estimer l’effort d’échantillonnage (nombre de passages, sightings = vrai sightings ou 1 individu vu plein de fois)

-   Dans la publi initiale, chaque observation (sighting et striking) est datée par cellule : permet de donner une idée de l’effort d’échantillonnage

-   dans la publi : les analyses prennent en compte les années et les saisons (sèche et humide)

-   On cherche influence de la route sur strikings mais chaque cellule a été distribuée le long de la route...

-   Données redondantes (% habitat crop par patch et présence/absence de crop)

-   Un 0 ou une valeur faible : plusieurs possibilités : soit l’individu n’a pas été détecté car pas présent dans le patch, soit il n’a pas été vu certaines années mais pour autant il était présent

# 
